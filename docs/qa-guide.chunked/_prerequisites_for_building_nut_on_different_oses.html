<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>6. Prerequisites for building NUT on different OSes</title><link rel="stylesheet" type="text/css" href="docbook-xsl.css" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="home" href="index.html" title="NUT Quality Assurance and Build Automation Guide" /><link rel="up" href="index.html" title="NUT Quality Assurance and Build Automation Guide" /><link rel="prev" href="_continuous_integration_nut_ci_farm_build_agent_preparation.html" title="5. Continuous Integration (NUT CI farm) build agent preparation" /><meta xmlns="" name="format-detection" content="telephone=no" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><td width="20%" align="left"><a accesskey="p" href="_continuous_integration_nut_ci_farm_build_agent_preparation.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> </td></tr></table><hr /></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_prerequisites_for_building_nut_on_different_oses"></a>6. Prerequisites for building NUT on different OSes</h2></div></div></div><p><a id="NUT_Config_Prereqs"></a>This chapter aims to list packages with the tools needed on a freshly minimally
deployed worker to build as many targets of NUT recipes as possible, mainly
the diverse driver and documentation types.</p><p>NUT codebase generally should not depend on particular operating system or
kernel technology and version, and with the operating systems listed below
one can benefit from use of containers (jails, zones) to build and test
against numerous OS distributions on one physical or virtual machine,
e.g. to cover non-regression with older tool kits while taking advantage
of new releases.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
For Linux systems, we have notes on <a class="ulink" href="../qa-guide.chunked/index.html#CI_LXC" target="_top">Custom NUT CI farm   build agents: LXC multi-arch containers</a> (or <code class="code">docs/ci-farm-lxc-setup.txt</code> in NUT sources for up-to-date information)
</li></ul></div><p>Some of the below are alternatives, e.g. compiler toolkits (gcc vs. clang)
or SSL implementations (OpenSSL vs. Mozilla NSS) — no problem installing
both, at a disk space cost.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><h3 class="title">Note</h3><p>Some NUT branches may need additional or different software versions
that are not yet included into <code class="literal">master</code> branch dependencies, e.g. the DMF
(Dynamic Mapping Files) sub-project needs LUA 5.1 for build and run-time,
and some Python modules for build, e.g. using OS packaging or custom call
to <code class="literal">pip install pycparser</code>.</p><p>In case your system still provides a Python 2.x environment (and for some
reason you want to use it instead of Python 3.x), but does not anymore
provide a <code class="literal">pip</code> nor <code class="literal">pycparser</code> packages for it, you may need to use an
external bootstrap first, e.g.:</p><pre class="screen"># Fetch get-pip.py for python 2.7
:; curl https://bootstrap.pypa.io/pip/2.7/get-pip.py --output get-pip.py
:; python2 get-pip.py
:; python2 -m pip --version
:; python2 -m pip install pycparser</pre></div><p>More packages and/or system setup may be needed to actually run NUT with
all features enabled; chapters below concern just with building it.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_general_call_to_test_the_ability_to_configure_and_build"></a>6.1. General call to Test the ability to configure and build</h3></div></div></div><p>Check out from git, generate files and configure to tailor to your build
environment, and build some tests:</p><pre class="screen">:; mkdir -p nut &amp;&amp; cd nut &amp;&amp; \
    git clone https://github.com/networkupstools/nut/ -b master .
:; ./autogen.sh &amp;&amp; \
    ./configure --with-doc=all --with-all --with-cgi &amp;&amp; \
    make all &amp;&amp; make check &amp;&amp; make spellcheck</pre><p>You can toggle some <code class="literal">configure</code> options to check different dependency
variants, e.g. <code class="literal">--with-ssl=nss</code> vs. <code class="literal">--with-ssl=openssl</code></p><p>For reproducible runs of various pre-sets of configuration during
development, take a look at <code class="literal">ci_build.sh</code> script and different <code class="literal">BUILD_TYPE</code>
(and other) environment variable settings that it supports. A minimal run
with it is just to call the script, e.g.:</p><pre class="screen">:; mkdir -p nut &amp;&amp; cd nut &amp;&amp; \
   git clone https://github.com/networkupstools/nut/ -b fightwarn .
:; ./ci_build.sh</pre><div class="note" style="margin-left: 0; margin-right: 10%;"><h3 class="title">Note</h3><p>To build older releases, such as "vanilla" NUT 2.7.4 and older,
you may need to address some nuances:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Ensure that <code class="literal">python</code> in <code class="literal">PATH</code> points to a python-2.x implementation
  (<code class="literal">master</code> branch is fixed to work with python 2 and 3)
</li><li class="listitem">
Ensure that <code class="literal">bash</code> is your user and maybe system shell (or ensure the
  generated <code class="literal">configure</code> script gets interpreted by it)
</li><li class="listitem">
Generally you may have better results with GNU Make newer than 3.81
  than with other make implementations; however, builds are regularly
  tested by CI with Sun dmake and BSD make as well, so recipes should
  not expect GNU-only syntax and constructs to work
</li><li class="listitem">
Parallel builds should be okay in current development version and
  since NUT 2.8.0 (is a bug to log and fix, if not), but they may be
  failure-prone in 2.7.4 and earlier releases
</li></ul></div></div><p>For intensive rebuilds, <code class="literal">ccache</code> is recommended. Note that instructions
below detail how to provide its directory with symlinks as <code class="literal">/usr/lib/ccache</code>
which is not the default case in all OS distributions. Recent versions of
the NUT <code class="literal">ci_build.sh</code> script allow to override the location by using the
<code class="literal">CI_CCACHE_SYMLINKDIR</code> environment variable, which is cumbersome and only
recommended for build agents with immutable system areas, etc.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_build_prerequisites_to_make_nut_from_scratch_on_various_operating_systems"></a>6.2. Build prerequisites to make NUT from scratch on various Operating Systems</h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_debian_ubuntu_and_derivatives"></a>Debian, Ubuntu and derivatives</h4></div></div></div><div class="note" style="margin-left: 0; margin-right: 10%;"><h3 class="title">Note</h3><p>Documented according to NUT CI farm build agents and development
workstation running Debian 10/11/12/13 (should at least partially apply
as far back as Debian 7/8), Ubuntu 14.x-25.x, and Termux revisions circa
2023-2025. This section generally covers a very wide family of APT-based
Debian-derived Linux operating system distributions.</p></div><p>Being a popular baseline among Linux distributions, Debian is an
important build target. Related common operating systems include
Ubuntu and customized distros for Raspberry Pi, Proxmox, as well
as many others.</p><p>For some (newer) distributions, <code class="literal">apt</code> or other front-ends may be
preferable to <code class="literal">apt-get</code>, but otherwise the commands are equivalent.</p><p>The package list below should largely apply to those as well,
however note that some well-known package names tend to differ.
A few of those are noted below.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><h3 class="title">Note</h3><p>While Debian distros I’ve seen (8 to 11) provide a "libusb-dev"
for libusb-0.1 headers, the binary library package name is specifically
versioned package by default of the current release (e.g. "libusb-0.1-4"),
while names of both the library and development packages for libusb-1.0
must be determined with:</p><pre class="screen">:; apt-cache search 'libusb.*1\.0.*'</pre><p>yielding e.g. "libusb-1.0-0-dev" (string name was seen with different
actual package source versions on both Debian 8 "Jessie" and
Debian 11 "Buster").</p></div><div class="note" style="margin-left: 0; margin-right: 10%;"><h3 class="title">FUN NOTE</h3><p>For development on the road (or a native ARM build) you can use the
<a class="ulink" href="https://termux.dev/en/" target="_top">Termux</a> project on Android. It provides
a sufficiently Debian-like operating environment for all intents and
purposes, but you may have to use their <code class="literal">pkg</code> wrapper instead of <code class="literal">apt</code>
tooling directly, and <code class="literal">ldd</code> may be in a package separate from <code class="literal">binutils</code>,
but otherwise the Debian/Ubuntu oriented lists of packages below apply.</p><p>You would need at least a couple of gigabytes available on the internal
phone storage though, especially if using <code class="literal">ccache</code> or setting up cross
builds.</p><p>The Termux distribution as of this writing seems to lack cppunit packages
but you can build it from <a class="ulink" href="https://www.freedesktop.org/wiki/Software/cppunit/" target="_top">https://www.freedesktop.org/wiki/Software/cppunit/</a>
e.g. <code class="literal">--with-prefix=${HOME}/nut-deps/usr</code> and <code class="literal">make install</code> there.
A custom <code class="literal">PKG_CONFIG_PATH=${HOME}/nut-deps/usr/lib/pkgconfig</code> would find
it during NUT build.</p></div><p>Debian-like package installations commonly start with an update of
metadata about recently published package revisions:</p><pre class="screen">:; apt-get update

:; apt-get install \
    ccache time \
    git perl curl \
    make autoconf automake libltdl-dev libtool binutils \
    valgrind \
    cppcheck \
    pkg-config \
    gcc g++ clang

# To debug eventual core dump files, or trace programs with an IDE like
# NetBeans (perhaps remotely), you may want the GNU Debugger program:
:; apt-get install \
    gdb

# NOTE: Older Debian-like distributions may lack a "libtool-bin"
:; apt-get install \
    libtool-bin

# See comments below, python version and package naming depends on distro
:; apt-get install \
    python

# NOTE: For python, you may eventually have to specify a variant like this
# (numbers depending on default or additional packages of your distro):
#   :; apt-get install python2 python2.7 python-is-python2
# and/or:
#   :; apt-get install python3 python3.9
# You can find a list of what is (pre-)installed with:
#   :; dpkg -l | grep -Ei 'perl|python'
#
# For localization maintenance (currently in Python NUT-Monitor app),
# provide an `msgfmt` implementation, e.g.:
#   :; apt-get install gettext
#
# To install the Python NUT-Monitor app, you may need some modules.
# Ideally, they would be packaged, named according to major Python version:
#   :; apt-get install python3-pyqt5
# or on newer (2025+) releases,
#   :; apt-get install python3-pyqt6 pyqt6-dev-tools
#
# If not packaged for your distro:
#   :; apt-get install pip
# For Python3:
#   :; python3 -m pip install PyQt5 configparser
# or
#   :; python3 -m pip install PyQt6 configparser

# For spell-checking, highly recommended if you would propose pull requests:
:; apt-get install \
    aspell aspell-en

# For other doc types (man-page, PDF, HTML) generation - massive packages
# (TEX, X11):
:; apt-get install \
    asciidoc source-highlight python3-pygments dblatex

# For CGI graph generation - massive packages (X11):
:; apt-get install \
    libgd-dev

# Debian 13 serves metadata needed for NUT to find where to install the
# service unit files in a separate development package; earlier distro
# releases did not seem to require it explicitly:
:; apt-get install \
    systemd-dev

# Optionally for sd_notify integration:
:; apt-get install \
    libsystemd-dev

# NOTE: Some older Debian-like distributions, could ship "libcrypto-dev"
# and/or "openssl-dev" instead of "libssl-dev" by its modern name
# and may lack a libgpiod2 + libgpiod-dev altogether
:; apt-get install \
    libcppunit-dev \
    libssl-dev libnss3-dev \
    augeas-tools libaugeas-dev augeas-lenses \
    libusb-dev libusb-1.0-0-dev \
    libi2c-dev \
    libmodbus-dev \
    libsnmp-dev \
    libpowerman0-dev \
    libfreeipmi-dev libipmimonitoring-dev \
    libavahi-common-dev libavahi-core-dev libavahi-client-dev
# For libneon, see below

# NOTE: Older Debian-like distributions may lack a "libgpiod-dev"
# Others above are present as far back as Debian 7 at least
:; apt-get install \
    libgpiod-dev

# NOTE: Some distributions lack a lua*-dev and only offer the base package
:; apt-get install lua5.1
:; apt-get install lua5.1-dev || true

:; apt-get install \
    bash dash ksh busybox</pre><p>Alternatives that can depend on your system’s other packaging choices:</p><pre class="screen">:; apt-get install libneon27-dev
# ... or
:; apt-get install libneon27-gnutls-dev</pre><p>Over time, Debian and Ubuntu had different packages and libraries providing
the actual methods for I2C; if your system lacks the <code class="literal">libi2c</code> (and so fails
to <code class="literal">./configure --with-all</code>), try adding the following packages:</p><pre class="screen">:; apt-get install build-essential git-core libi2c-dev i2c-tools lm-sensors</pre><p>For cross-builds (note that not everything supports multilib approach,
limiting standard package installations to one or another implementation;
in that case local containers each with one ARCH may be a better choice,
with <code class="literal">qemu-user-static</code> playing a role to "natively" run the other-ARCH
complete environments):</p><pre class="screen">:; apt-get install \
    gcc-multilib g++-multilib \
    crossbuild-essential \
    gcc-10:armhf gcc-10-base:armhf \
    qemu-user-static</pre><div class="note" style="margin-left: 0; margin-right: 10%;"><h3 class="title">Note</h3><p>For Jenkins agents, also need to <code class="literal">apt-get install openjdk-21-jdk-headless</code>.
You may have to ensure that <code class="literal">/proc</code> is mounted in the target chroot
(or do this from the running container).</p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_centos_6_and_7"></a>CentOS 6 and 7</h4></div></div></div><p>CentOS is another popular baseline among Linux distributions, being a free
derivative of the RedHat Linux, upon which many other distros are based as
well. These systems typically use the RPM package manager, using directly
<code class="literal">rpm</code> command, or <code class="literal">yum</code> or <code class="literal">dnf</code> front-ends depending on their generation.</p><p>For CI farm container setup, prepared root filesystem archives from
<a class="ulink" href="http://download.proxmox.com/images/system/" target="_top">http://download.proxmox.com/images/system/</a> worked sufficiently well.</p><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="_prepare_centos_repository_mirrors"></a>Prepare CentOS repository mirrors</h5></div></div></div><p>For CentOS 7 it seems that not all repositories are equally good; some of
the software below is only served by EPEL (Extra Packages for Enterprise
Linux), as detailed at:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<a class="ulink" href="https://docs.fedoraproject.org/en-US/epel/" target="_top">https://docs.fedoraproject.org/en-US/epel/</a>
</li><li class="listitem">
<a class="ulink" href="https://www.redhat.com/en/blog/whats-epel-and-how-do-i-use-it" target="_top">https://www.redhat.com/en/blog/whats-epel-and-how-do-i-use-it</a>
</li><li class="listitem">
<a class="ulink" href="https://pkgs.org/download/epel-release" target="_top">https://pkgs.org/download/epel-release</a>
</li></ul></div><p>You may have to specify a mirror as the <code class="literal">baseurl</code> in a <code class="literal">/etc/yum.repos.d/...</code>
file (as the aged distributions become less served by mirrors), such as:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p class="simpara">
<a class="ulink" href="https://www.mirrorservice.org/sites/dl.fedoraproject.org/pub/epel/7/x86_64/" target="_top">https://www.mirrorservice.org/sites/dl.fedoraproject.org/pub/epel/7/x86_64/</a>
</p><pre class="screen"># e.g. for CentOS7 currently:
:; yum install \
   https://download-ib01.fedoraproject.org/pub/epel/7/x86_64/Packages/e/epel-release-7-14.noarch.rpm

# And edit /etc/yum.repos.d/epel.repo to uncomment and set the baseurl=...
# lines, and comment away the mirrorlist= lines (if yum hiccups otherwise)</pre></li></ul></div><p>For systemd support on CentOS 7 (no equivalent found for CentOS 6),
you can use backports repository below:</p><pre class="screen">:; curl https://copr.fedorainfracloud.org/coprs/jsynacek/systemd-backports-for-centos-7
    &gt; /etc/yum.repos.d/systemd-backports-for-centos-7.repo</pre><p>For CentOS 6 (the oldest I could try) the situation is similar, with sites like
<a class="ulink" href="https://www.getpagespeed.com/server-setup/how-to-fix-yum-after-centos-6-went-eol" target="_top">https://www.getpagespeed.com/server-setup/how-to-fix-yum-after-centos-6-went-eol</a>
detailing how to replace <code class="literal">/etc/yum.repos.d/</code> contents (you can wholesale rename
the existing directory and populate a new one with <code class="literal">curl</code> downloads from the
article), and additional key trust for EPEL packages:</p><pre class="screen">:; yum install \
   https://dl.fedoraproject.org/pub/archive/epel/6/x86_64/epel-release-6-8.noarch.rpm</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="_set_up_centos_packages_for_nut"></a>Set up CentOS packages for NUT</h5></div></div></div><p>Instructions below apply to both CentOS 6 and 7 (a few nuances for 6 commented).
For newer distributions, <code class="literal">dnf</code> may be preferable to <code class="literal">yum</code>, but otherwise the
commands are equivalent.</p><p>General developer system helpers mentioned in <a class="ulink" href="../qa-guide.chunked/index.html#CI_LXC" target="_top">Custom NUT CI farm build agents: LXC multi-arch containers</a> (or <code class="code">docs/ci-farm-lxc-setup.txt</code> in NUT sources for up-to-date information):</p><pre class="screen">:; yum update

:; yum install \
    sudo vim mc p7zip pigz pbzip2 tar</pre><p>To have SSH access to the build VM/Container, you may have to install and
enable it:</p><pre class="screen">:; yum install \
    openssh-server openssh-clients

:; chkconfig sshd on
:; service sshd start

# If there are errors loading generated host keys, remove mentioned files
# including the one with .pub extension and retry with:
#:; service sshd restart</pre><div class="note" style="margin-left: 0; margin-right: 10%;"><h3 class="title">Note</h3><p>Below we request to install generic <code class="literal">python</code> per system defaults.
You may request specifically <code class="literal">python2</code> or <code class="literal">python3</code> (or both): current
NUT should be compatible with both (2.7+ at least).</p></div><div class="note" style="margin-left: 0; margin-right: 10%;"><h3 class="title">Note</h3><p>On CentOS, <code class="literal">libusb</code> means 0.1.x and <code class="literal">libusbx</code> means 1.x.x API version
(latter is not available for CentOS 6).</p></div><div class="note" style="margin-left: 0; margin-right: 10%;"><h3 class="title">Note</h3><p>On CentOS, it seems that development against libi2c/smbus is not
supported. Neither the suitable devel packages were found, nor i2c-based
drivers in distro packaging of NUT. Resolution and doc PRs are welcome.</p></div><pre class="screen">:; yum install \
    ccache time \
    file \
    git perl curl \
    make autoconf automake libtool-ltdl-devel libtool \
    valgrind \
    cppcheck \
    pkgconfig \
    gcc gcc-c++ clang

# To debug eventual core dump files, or trace programs with an IDE like
# NetBeans (perhaps remotely), you may want the GNU Debugger program:
:; yum install \
    gdb

# See comments below, python version and package naming depends on distro
:; yum install \
    python

# NOTE: For python, you may eventually have to specify a variant like this
# (numbers depending on default or additional packages of your distro):
#   :; yum install python-2.7.5
# and/or:
#   :; yum install python3 python3-3.6.8
# You can find a list of what is (pre-)installed with:
#   :; rpm -qa | grep -Ei 'perl|python'
# Note that CentOS 6 includes python-2.6.x and does not serve newer versions

# For spell-checking, highly recommended if you would propose pull requests:
:; yum install \
    aspell aspell-en

# For other doc types (man-page, PDF, HTML) generation - massive packages
# (TEX, X11):
:; yum install \
    asciidoc source-highlight python-pygments dblatex

# For CGI graph generation - massive packages (X11):
:; yum install \
    gd-devel

# Optionally for sd_notify integration (on CentOS 7+, not on 6):
:; yum install \
    systemd-devel

# NOTE: "libusbx" is the CentOS way of naming "libusb-1.0" (not in CentOS 6)
# vs. the older "libusb" as the package with "libusb-0.1"
:; yum install \
    cppunit-devel \
    openssl-devel nss-devel \
    augeas augeas-devel \
    libusb-devel libusbx-devel \
    i2c-tools \
    libmodbus-devel \
    net-snmp-devel \
    powerman-devel \
    freeipmi-devel \
    avahi-devel \
    neon-devel
#?# is python-augeas needed? exists at least...
#?# no (lib)i2c-devel ...
#?# no (lib)ipmimonitoring-devel ... would "freeipmi-ipmidetectd"
#?#     cut it at least for run-time?
#?# no (lib)gpio(d)-devel - starts with CentOS 8 (or extra repositories
#?#     for later minor releases of CentOS 7)

# Some NUT code related to lua may be currently limited to lua-5.1
# or possibly 5.2; the former is default in CentOS 7 releases...
:; yum install \
    lua-devel

:; yum install \
    bash dash ksh</pre><div class="note" style="margin-left: 0; margin-right: 10%;"><h3 class="title">Note</h3><p><code class="literal">busybox</code> is not packaged for CentOS 7 release; a static binary can
be downloaded if needed. For more details, see
<a class="ulink" href="https://unix.stackexchange.com/questions/475584/cannot-install-busybox-on-centos" target="_top">https://unix.stackexchange.com/questions/475584/cannot-install-busybox-on-centos</a></p></div><p>CentOS packaging for 64-bit systems delivers the directory for dispatching
compiler symlinks as <code class="literal">/usr/lib64/ccache</code>. You can set it up same way as for
other described environments by adding a symlink <code class="literal">/usr/lib/ccache</code>:</p><pre class="screen">:; ln -s ../lib64/ccache/ "$ALTROOT"/usr/lib/</pre><div class="note" style="margin-left: 0; margin-right: 10%;"><h3 class="title">Note</h3><p>For Jenkins agents, also need to install JDK 17 or newer, which is not
available for CentOS 6 nor 7 directly (in distribution packaging).
Alternative packaging, such as Temurin from the Adoptium project, is possible
(checked for at least CentOS 7), see
<a class="ulink" href="https://adoptium.net/installation/linux/#_centosrhelfedora_instructions" target="_top">their
instructions</a> for specific details. This may require updated library package
versions as dependencies from the OS distribution, so you may also have to make
sure that  your <code class="literal">/etc/yum.repos.d/*</code> files (certainly <code class="literal">CentOS-Base.repo</code>, maybe
also <code class="literal">CentOS-fasttrack.repo</code> and/or <code class="literal">CentOS-CR.repo</code>) to use e.g.</p><pre class="screen">baseurl=https://vault.centos.org/centos/$releasever/os/$basearch/</pre><p>lines if the <code class="literal">mirrorlist</code> ones do not suffice to find living mirrors (WARNING:
the <code class="literal">/os/</code> part of the URL would vary for different repository types).</p></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_arch_linux"></a>Arch Linux</h4></div></div></div><p>Update the lower-level OS and package databases:</p><pre class="screen">:; pacman -Syu</pre><p>Install tools and prerequisites for NUT:</p><pre class="screen">:; pacman -S --needed \
    base-devel \
    autoconf automake libtool libltdl \
    clang gcc \
    ccache \
    git \
    vim python perl \
    pkgconf \
    cppcheck valgrind

# To debug eventual core dump files, or trace programs with an IDE like
# NetBeans (perhaps remotely), you may want the GNU Debugger program:
:; pacman -S --needed \
    gdb

# For spell-checking, highly recommended if you would propose pull requests:
:; pacman -S --needed \
    aspell en-aspell

# For man-page doc types generation:
:; pacman -S --needed \
    asciidoc

# For other doc types (PDF, HTML) generation - massive packages (TEX, X11):
:; pacman -S --needed \
    source-highlight dblatex

# For CGI graph generation - massive packages (X11):
:; pacman -S --needed \
    gd

# Optionally for sd_notify integration:
:; pacman -S --needed \
    systemd

:; pacman -S --needed \
    cppunit \
    openssl nss \
    augeas \
    libusb \
    neon \
    net-snmp \
    freeipmi \
    avahi

#?# no (lib)gpio(d)

:; pacman -S --needed \
    lua51

:; pacman -S --needed \
    bash dash busybox ksh93</pre><p>Recommended for NUT CI farm integration (matching specific toolkit versions
in a build matrix), and note the unusual location of <code class="literal">/usr/lib/ccache/bin/</code>
for symlinks:</p><pre class="screen">:; gcc --version
gcc (GCC) 12.2.0
...

# Note: this distro delivers "gcc" et al as file names
# so symlinks like this may erode after upgrades.
# TODO: Rename and then link?..
:; (cd /usr/bin \
    &amp;&amp; for V in 12 12.2.0 ; do for T in gcc g++ cpp ; do \
        ln -fsr $T $T-$V ; \
    done; done)
:; (cd /usr/lib/ccache/bin/ \
    &amp;&amp; for V in 12 12.2.0 ; do for T in gcc g++ ; do \
        ln -fsr /usr/bin/ccache $T-$V ; \
    done; done)


:; clang --version
clang version 14.0.6
...

:; (cd /usr/bin &amp;&amp; ln -fs clang-14 clang++-14 &amp;&amp; ln -fs clang-14 clang-cpp-14)
:; (cd /usr/lib/ccache/bin/ \
    &amp;&amp; for V in 14 ; do for T in clang clang++ ; do \
        ln -fsr /usr/bin/ccache $T-$V ; \
    done; done)</pre><p>Also for CI build agents, a Java environment (JDK17+ since autumn 2024) is
required:</p><pre class="screen"># Search for available Java versions:
:; pacman -Ss | egrep 'jre|jdk'

# Pick one:
:; pacman -S --needed \
    jre17-openjdk-headless

# If needed to change default implementation, consult:
:; archlinux-java help</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_slackware_linux_15"></a>Slackware Linux 15</h4></div></div></div><p>Another long-term presence in the Linux landscape, and sometimes the baseline
for appliances, the Slackware project recently hit release 15 in 2022, averaging
two years per major release.</p><p>It can be installed e.g. in a VM, using ISO images from the project site; see:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<a class="ulink" href="http://www.slackware.com/" target="_top">http://www.slackware.com/</a> ⇒ <a class="ulink" href="http://www.slackware.com/getslack/" target="_top">http://www.slackware.com/getslack/</a> ⇒
  <a class="ulink" href="https://mirrors.slackware.com/slackware/slackware-iso/slackware64-15.0-iso/" target="_top">https://mirrors.slackware.com/slackware/slackware-iso/slackware64-15.0-iso/</a>
</li><li class="listitem">
<a class="ulink" href="https://slackware.nl/slackware/slackware64-current-iso/" target="_top">https://slackware.nl/slackware/slackware64-current-iso/</a>
</li></ul></div><p>You would have to first log in as <code class="literal">root</code> and run <code class="literal">cgdisk</code> to define partitioning
for your virtual HDD, such as the common <code class="literal">/boot</code>, <code class="literal">swap</code> and <code class="literal">/</code> Linux layout,
and run <code class="literal">setup</code> to install "everything".</p><p>Note that "out of the box" Slackware does not currently on networked package
repositories and calculated dependency trees, so one has to know exactly what
they want installed.</p><p>Third-party projects for package managers are also available, e.g.
<a class="ulink" href="https://slackpkg.org/documentation.html" target="_top"><code class="literal">slackpkg</code></a> ⇒ see also
<a class="ulink" href="https://docs.slackware.com/slackware:slackpkg" target="_top">https://docs.slackware.com/slackware:slackpkg</a> and
<a class="ulink" href="https://slackpkg.org/stable/" target="_top">https://slackpkg.org/stable/</a> :</p><pre class="screen">:; wget https://slackpkg.org/stable/slackpkg-15.0.10-noarch-1.txz &amp;&amp; \
   installpkg slackpkg-15.0.10-noarch-1.txz</pre><p>Uncomment a mirror from <code class="literal">/etc/slackpkg/mirrors</code> according to your location
and other preferences (or use the top-listed default), and begin with:</p><pre class="screen">:; slackpkg update</pre><p>Note that packages may be only installed or re-installed/upgraded as separate
explicit operations, so the procedure to bring your system into needed shape
is a bit cumbersome (and each command may by default be interactive with a
choice menu), e.g.:</p><pre class="screen">:; for P in \
    bash mc vim sudo \
   ; do slackpkg info "$P" || slackpkg install $P || break ; done</pre><p>For procedures below, this is automated via <code class="literal">root</code> profile to become a
<code class="literal">slackpkg-install</code> command:</p><pre class="screen">:; grep "slackpkg-install" ~/.profile || {
    cat &gt;&gt; ~/.profile &lt;&lt; 'EOF'
slackpkg-install() {
    for P in "$@" ; do
        echo "=== $P:"
        slackpkg info "$P" || slackpkg install "$P" || break
    done
}
EOF
   }
:; . ~/.profile</pre><p>If something has a hiccup, it suggests to look for the right name, e.g.:</p><pre class="screen">:; slackpkg search python</pre><p>For NUT dependencies and build tools:</p><pre class="screen">:; slackpkg update

# Baseline toolkits:
# Note there is no cppcheck, cppunit, valgrind...
# Note clang compiler tools are part of llvm package
:; slackpkg-install \
    ccache time \
    coreutils diffutils \
    git python3 perl curl \
    make autoconf automake libtool binutils \
    pkg-config \
    gcc llvm

# To debug eventual core dump files, or trace programs with an IDE like
# NetBeans (perhaps remotely), you may want the GNU Debugger program:
:; slackpkg-install gdb

# For spell-checking, highly recommended if you would propose pull requests:
:; slackpkg-install aspell{,-en}

# Note there is no direct "asciidoc" nor "a2x", just the competing project
# "rubygem-asciidoctor" that NUT currently has no recipes for, so you can
# not compile man/html/pdf docs here, per the default repository. See below
# for tools from alternative repositories, which seem to work well. Man page
# compilation would require docbook-xml resources; older versions are in
# this package https://slackbuilds.org/repository/15.0/system/docbook-xml/
# and recent ones are in not-installed part of main repository:
:; slackpkg-install linuxdoc-tools

# More on Python (for NUT-Monitor UI):
:; slackpkg-install \
    python-pip qt5 gettext-tools gettext
# FIXME: Consider qt6 since 2025

# For CGI graph generation - massive packages (X11):
:; slackpkg-install \
    gd

# General dependencies:
:; slackpkg-install \
    openssl openssl-solibs mozilla-nss \
    libusb \
    net-snmp \
    neon

# Shells:
:; slackpkg-install \
    bash dash ksh93</pre><p>Some more packages are available on the side, including Java (useful
e.g. to make this environment into a fully fledged Jenkins worker).
Other common NUT dependencies absent from primary Slackware repositories
can be found and downloaded (seek <code class="literal">*.txz</code> package files, although a few
are named <code class="literal">*.tgz</code>) from here, and passed to <code class="literal">installpkg</code>:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<a class="ulink" href="http://www.slackware.com/~alien/slackbuilds/openjdk17/" target="_top">http://www.slackware.com/~alien/slackbuilds/openjdk17/</a>
</li><li class="listitem">
<a class="ulink" href="http://www.slackware.com/~alien/slackbuilds/asciidoc/" target="_top">http://www.slackware.com/~alien/slackbuilds/asciidoc/</a>
</li><li class="listitem">
<a class="ulink" href="http://www.slackware.com/~alien/slackbuilds/cppunit/" target="_top">http://www.slackware.com/~alien/slackbuilds/cppunit/</a>
</li><li class="listitem">
<a class="ulink" href="http://www.slackware.com/" target="_top">http://www.slackware.com/</a><sub>alien/slackbuilds/lua/ (5.1 in "stable") and
  <a class="ulink" href="http://www.slackware.com/" target="_top">http://www.slackware.com/</a></sub>alien/slackbuilds/lua53/ (5.4 in "current"
  as of Slackware 15.1 candidate in the works) — note that LUA is not
  needed for the current NUT code base, but may become needed after import
  of features from forks
</li></ul></div><p>…and even the environment for Windows cross-builds, ancient compilers
and modern toolkits to cover all bases:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<a class="ulink" href="http://www.slackware.com/~alien/slackbuilds/MinGW-w64/" target="_top">http://www.slackware.com/~alien/slackbuilds/MinGW-w64/</a>
</li><li class="listitem">
<a class="ulink" href="http://www.slackware.com/~alien/slackbuilds/docker/" target="_top">http://www.slackware.com/~alien/slackbuilds/docker/</a>
</li><li class="listitem">
<a class="ulink" href="http://www.slackware.com/~alien/slackbuilds/gcc34/" target="_top">http://www.slackware.com/~alien/slackbuilds/gcc34/</a>
</li><li class="listitem">
<a class="ulink" href="http://www.slackware.com/~alien/slackbuilds/gcc5/" target="_top">http://www.slackware.com/~alien/slackbuilds/gcc5/</a>
</li></ul></div><p>FWIW, another "more official" but older Java package seems to be at:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<a class="ulink" href="http://www.slackware.com/~alien/slackbuilds/openjdk/" target="_top">http://www.slackware.com/~alien/slackbuilds/openjdk/</a>
</li><li class="listitem">
<a class="ulink" href="https://slackbuilds.org/repository/15.0/development/jdk/" target="_top">https://slackbuilds.org/repository/15.0/development/jdk/</a>
</li></ul></div><p>An example routine to install the latest instance of a package could be
like this:</p><pre class="screen">:; wget -m -l1 http://www.slackware.com/~alien/slackbuilds/asciidoc/pkg/ &amp;&amp; \
    find . -name '*.t?z'

:; (cd ./www.slackware.com/~alien/slackbuilds/asciidoc/pkg/ &amp;&amp; \
    installpkgasciidoc-8.1.0-noarch-2.tgz )</pre><p>Note that some packages are further separated by Slackware version, e.g. with
sub-directories for <code class="literal">15.0</code> and <code class="literal">current</code>:</p><pre class="screen">:; wget -r -l1 -nd -R gif,css,jpg,html,htm --remove-listing \
    http://www.slackware.com/~alien/slackbuilds/openjdk17/pkg64/15.0/

:; installpkg openjdk17-17.0.12_7-x86_64-1alien.txz</pre><p>Upon community members' recommendations, Sotirov’s SlackPack is also considered
a reputable repository: <a class="ulink" href="https://sotirov-bg.net/slackpack/" target="_top">https://sotirov-bg.net/slackpack/</a> and should cover most
if not all of the dependencies required for NUT building (including PowerMan,
IPMI etc.)</p><div class="note" style="margin-left: 0; margin-right: 10%;"><h3 class="title">Note</h3><p>If setting up a CI farm agent with builds in RAM disk, keep in mind that
default mount options for <code class="literal">/dev/shm</code> preclude script execution. Either set up
the agent in a non-standard fashion (to use another work area), or if this is
a dedicated machine — relax the mount options in <code class="literal">/etc/fstab</code>.</p><p>Here is an example with <code class="literal">noexec</code> which we <span class="strong"><strong>must avoid</strong></span> for such use-case:</p><pre class="screen">:; mount | grep /dev/shm
tmpfs on /dev/shm type tmpfs (rw,nosuid,nodev,noexec,relatime,inode64)</pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_freebsd_12_2"></a>FreeBSD 12.2</h4></div></div></div><div class="note" style="margin-left: 0; margin-right: 10%;"><h3 class="title">Note</h3><p>As of 2024, this version is way beyond EOL — packages have been
removed from mirrors. A discussion at
<a class="ulink" href="https://forums.freebsd.org/threads/easy-upgrading-from-12-2-rel-in-2024.92695/" target="_top">https://forums.freebsd.org/threads/easy-upgrading-from-12-2-rel-in-2024.92695/</a>
touches on upgrades in such situation. An alternate mirror (that worked to
bump the system to <code class="literal">openjdk17</code>, as of this writing in Nov 2024) can be found
at <a class="ulink" href="https://mirror.sg.gs/freebsd-pkg/FreeBSD:12:amd64/quarterly/" target="_top">https://mirror.sg.gs/freebsd-pkg/FreeBSD:12:amd64/quarterly/</a> and written
into <code class="literal">/etc/pkg/FreeBSD.conf</code> similarly to existing <code class="literal">url</code> entry.</p></div><p>Note that <code class="literal">PATH</code> for builds on BSD should include <code class="literal">/usr/local/...</code>:</p><pre class="screen">:; PATH=/usr/local/libexec/ccache:/usr/local/bin:/usr/bin:$PATH
:; export PATH</pre><div class="note" style="margin-left: 0; margin-right: 10%;"><h3 class="title">Note</h3><p>You may want to reference <code class="literal">ccache</code> even before all that, as detailed
below.</p></div><pre class="screen">:; pkg install \
    git perl5 curl \
    gmake autoconf automake autotools libltdl libtool \
    valgrind \
    cppcheck \
    pkgconf \
    gcc clang

# To debug eventual core dump files, or trace programs with an IDE like
# NetBeans (perhaps remotely), you may want the GNU Debugger program:
:; pkg install \
    gdb

# See comments below, python version and package naming depends on distro
:; pkg install \
    python

# NOTE: For python, you may eventually have to specify a variant like this
# (numbers depending on default or additional packages of your distro):
#   :; pkg install python2 python27
# and/or:
#   :; pkg install python3 python37
# You can find a list of what is (pre-)installed with:
#   :; pkg info | grep -Ei 'perl|python'

# For spell-checking, highly recommended if you would propose pull requests:
:; pkg install \
    aspell en-aspell

# For other doc types (man-page, PDF, HTML) generation - massive packages
# (TEX, X11):
:; pkg install \
    asciidoc source-highlight textproc/py-pygments dblatex

# For CGI graph generation - massive packages (X11):
:; pkg install \
    libgd

:; pkg install \
    cppunit \
    nss \
    augeas \
    libmodbus \
    neon \
    net-snmp \
    powerman \
    freeipmi \
    avahi

# NOTE: At least on FreeBSD 12, system-provided crypto exists and is used
# by libnetsnmp, libneon, etc. - but is not marked as a package. Conversely,
# the openssl-1.1.1k (as of this writing) can be installed as a package into
# /usr/local/lib and then causes linking conflicts. The core system-provided
# build of openssl does include headers and is useful for NUT build "as is".
# ONLY INSTALL THIS PACKAGE IF REQUIRED (may get problems to rectify later):
:; test -e /lib/libcrypto.so -a -e /usr/lib/libssl.so || \
   pkg install openssl

:; pkg install \
    lua51

:; pkg install \
    bash dash busybox ksh93</pre><p>Recommended:</p><pre class="screen">:; pkg install ccache
:; ccache-update-links</pre><p>For compatibility with common setups on other operating systems, can symlink
<code class="literal">/usr/local/libexec/ccache</code> as <code class="literal">/usr/lib/ccache</code> and possibly add dash-number
suffixed symlinks to compiler tools (e.g. <code class="literal">gcc-10</code> beside <code class="literal">gcc10</code> installed
by package).</p><div class="note" style="margin-left: 0; margin-right: 10%;"><h3 class="title">Note</h3><p>For Jenkins agents, also need to <code class="literal">pkg install openjdk11</code> (17 or 21
required since autumn 2024) — and do note its further OS configuration
suggestions for special filesystem mounts.</p></div><p>Due to BSD specific paths <span class="strong"><strong>when not using</strong></span> an implementation of <code class="literal">pkg-config</code>
or <code class="literal">pkgconf</code> (so guessing of flags is left to administrator — TBD in NUT
<code class="literal">m4</code> scripts), better use this routine to test the config/build:</p><pre class="screen">:; ./configure --with-doc=all --with-all --with-cgi \
    --without-avahi --without-powerman --without-modbus \
    ### CPPFLAGS="-I/usr/local/include -I/usr/include" \
    ### LDFLAGS="-L/usr/local/lib -L/usr/lib"</pre><p>Note the lack of <code class="literal">pkg-config</code> also precludes <code class="literal">libcppunit</code> tests, although
they also tend to mis-compile/mis-link with GCC (while CLANG seems okay).</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_openbsd_6_5"></a>OpenBSD 6.5</h4></div></div></div><p>Note that <code class="literal">PATH</code> for builds on BSD should include <code class="literal">/usr/local/...</code>:</p><pre class="screen">:; PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:$PATH
:; export PATH</pre><div class="note" style="margin-left: 0; margin-right: 10%;"><h3 class="title">Note</h3><p>You may want to reference <code class="literal">ccache</code> even before all that, as detailed
below.</p></div><p>OpenBSD delivers many versions of numerous packages, you should specify
your pick interactively or as part of package name (e.g. <code class="literal">autoconf-2.69p2</code>).</p><div class="note" style="margin-left: 0; margin-right: 10%;"><h3 class="title">Note</h3><p>For the purposes of builds with Jenkins CI agents, since summer 2022 it
requires JDK11 which was first delivered with OpenBSD 6.5. Earlier iterations
used OpenBSD 6.4 and version nuances in this document may still reflect that.</p></div><p>FIXME: Since autumn 2024, JDK17+ is required. Maybe time to EOL OpenBSD 6.x
workers, or to SSH into them from a nearby machine’s Java agent?.. Alternately,
consider <a class="ulink" href="https://github.com/adoptium/jdk17/blob/master/doc/building.md" target="_top">https://github.com/adoptium/jdk17/blob/master/doc/building.md</a></p><p>During builds, you may have to tell system dispatcher scripts which version
to use (which feels inconvenient, but on the up-side for CI — this system
allows to test many versions of auto-tools in the same agent), e.g.:</p><pre class="screen">:; export AUTOCONF_VERSION=2.69 AUTOMAKE_VERSION=1.13</pre><p>To use the <code class="literal">ci_build.sh</code> don’t forget <code class="literal">bash</code> which is not part of OpenBSD
base installation. It is not required for "legacy" builds arranged by just
<code class="literal">autogen.sh</code> and <code class="literal">configure</code> scripts.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><h3 class="title">Note</h3><p>The OpenBSD 6.5 <code class="literal">install65.iso</code> installation includes a set of packages
that seems to exceed whatever is available on network mirrors; for example,
the CD image included <code class="literal">clang</code> program while it is not available to <code class="literal">pkg_add</code>,
at least not via <a class="ulink" href="http://ftp.netbsd.hu/mirrors/openbsd/6.5/packages/amd64/" target="_top">http://ftp.netbsd.hu/mirrors/openbsd/6.5/packages/amd64/</a>
mirror. The <code class="literal">gcc</code> version on CD image differed notably from that in the
networked repository (4.2.x vs. 4.9.x).
You may have to echo a working base URL (part before "6.5/…" into the
<code class="literal">/etc/installurl</code> file, since the old distribution is no longer served by
default site.</p></div><pre class="screen"># Optionally, make the environment comfortable, e.g.:
:; pkg_add sudo bash mc wget rsync

:; pkg_add \
    git curl \
    gmake autoconf automake libltdl libtool \
    valgrind \
    cppcheck \
    pkgconf \
    gcc clang

# To debug eventual core dump files, or trace programs with an IDE like
# NetBeans (perhaps remotely), you may want the GNU Debugger program:
:; pkg_add install \
    gdb

# See comments below, python version and package naming depends on distro
:; pkg_add \
    python

# NOTE: For python, you may eventually have to specify a variant like this
# (numbers depending on default or additional packages of your distro):
#   :; pkg_add python-2.7.15p0 py-pip
# and/or:
#   :; pkg_add python-3.6.6p1 py3-pip
# although you might succeed specifying shorter names and the packager
# will offer a list of matching variants (as it does for "python" above).
# NOTE: "perl" is not currently a package, but seemingly part of base OS.
# You can find a list of what is (pre-)installed with:
#   :; pkg_info | grep -Ei 'perl|python'

# For spell-checking, highly recommended if you would propose pull requests:
:; pkg_add \
    aspell

# For other doc types (man-page, PDF, HTML) generation - massive packages
# (TEX, X11):
:; pkg_add \
    asciidoc source-highlight py-pygments dblatex \
    docbook2x docbook-to-man

# For CGI graph generation - massive packages (X11):
:; pkg_add \
    gd

:; pkg_add \
    cppunit \
    openssl nss \
    augeas \
    libusb1 \
    net-snmp \
    avahi

# For netxml-ups driver the library should suffice; however for nut-scanner
# you may currently require to add a `libneon.so` symlink (the package seems
# to only deliver a numbered SO library name), e.g.:
:; pkg_add neon &amp;&amp; \
   if ! test -s /usr/local/lib/libneon.so ; then
    ln -s "`cd /usr/local/lib &amp;&amp; ls -1 libneon.so.* | sort -n | tail -1`" \
        /usr/local/lib/libneon.so
   fi

# Select a LUA-5.1 (or possibly 5.2?) version
:; pkg_add \
    lua

:; pkg_add \
    bash dash ksh93

:; pkg_add \
    argp-standalone \
    freeipmi</pre><p>Recommended:</p><pre class="screen">:; pkg_add ccache
:; ( mkdir -p /usr/lib/ccache &amp;&amp; cd /usr/lib/ccache &amp;&amp; \
        for TOOL in cpp gcc g++ clang clang++ clang-cpp ; do \
            ln -s ../../local/bin/ccache "$TOOL" ; \
        done ; \
   )

:; ( cd /usr/bin &amp;&amp; for T in gcc g++ cpp ; \
    do ln -s "$T" "$T-4.2.1" ; done )
:; ( cd /usr/lib/ccache &amp;&amp; for T in gcc g++ cpp ; \
    do ln -s "$T" "$T-4.2.1" ; done )

:; ( cd /usr/bin &amp;&amp; for T in clang clang++ clang-cpp ; \
    do ln -s "$T" "$T-7.0.1" ; done )
:; ( cd /usr/lib/ccache &amp;&amp; for T in clang clang++ clang-cpp ; \
    do ln -s "$T" "$T-7.0.1" ; done )</pre><p>For compatibility with common setups on other operating systems, can add
dash-number suffixed symlinks to compiler tools (e.g. <code class="literal">gcc-4.2.1</code> beside
<code class="literal">gcc</code> installed by package) into <code class="literal">/usr/lib/ccache</code>.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><h3 class="title">Note</h3><p>For Jenkins agents, also need to <code class="literal">pkg_add jdk</code> (if asked, pick version
11 or 17); can request <code class="literal">pkg_add jdk%11</code>. You would likely have to update
the trusted CA store to connect to NUT CI, see e.g. (raw!) download from
<a class="ulink" href="https://gist.github.com/galan/ec8b5f92dd325a97e2f66e524d28aaf8" target="_top">https://gist.github.com/galan/ec8b5f92dd325a97e2f66e524d28aaf8</a>
but ensure that you run it with <code class="literal">bash</code> and it does <code class="literal">wget</code> the certificates
(maybe with <code class="literal">--no-check-certificate</code> option if the OS does not trust current
internet infrastructure either), and revise the suggested certificate files
vs. <a class="ulink" href="https://letsencrypt.org/certificates/" target="_top">https://letsencrypt.org/certificates/</a> and/or comments to that gist.</p></div><p>Due to BSD specific paths <span class="strong"><strong>when not using</strong></span> an implementation of <code class="literal">pkg-config</code>
or <code class="literal">pkgconf</code> (so guessing of flags is left to administrator — TBD in NUT
<code class="literal">m4</code> scripts), better use this routine to test the config/build:</p><pre class="screen">:; ./configure --with-doc=all --with-all --with-cgi \
    --without-avahi --without-powerman --without-modbus \
    ### CPPFLAGS="-I/usr/local/include -I/usr/include"
    ### LDFLAGS="-L/usr/local/lib -L/usr/lib"</pre><p>Note the lack of <code class="literal">pkg-config</code> also precludes <code class="literal">libcppunit</code> tests, although
they also tend to mis-compile/mis-link with GCC (while CLANG seems okay).</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_netbsd_9_2"></a>NetBSD 9.2</h4></div></div></div><p>Instructions below assume that <code class="literal">pkgin</code> tool (pkg-src component to
"install binary packages") is present on the system. Text below
was prepared with a VM where "everything" was installed from the
ISO image, including compilers and X11. It is possible that some
packages provided this way differ from those served by <code class="literal">pkgin</code>,
or on the contrary, that the list of suggested tool installation
below would not include something a bare-minimum system would
require to build NUT.</p><p>Note that <code class="literal">PATH</code> for builds on NetBSD should include <code class="literal">local</code> and
<code class="literal">pkg</code>; the default after installation of the test system was:</p><pre class="screen">:; PATH="/sbin:/usr/sbin:/bin:/usr/bin:/usr/pkg/sbin:/usr/pkg/bin"
:; PATH="$PATH:/usr/X11R7/bin:/usr/local/sbin:/usr/local/bin"
:; export PATH</pre><div class="note" style="margin-left: 0; margin-right: 10%;"><h3 class="title">Note</h3><p>You may want to reference <code class="literal">ccache</code> even before all that,
e.g. in the system-wide <code class="literal">/etc/profile</code> or build-user’s <code class="literal">~/.profile</code>,
as detailed below:</p></div><pre class="screen">:; PATH="/usr/lib/ccache:$PATH"
:; export PATH</pre><p>To use the <code class="literal">ci_build.sh</code> don’t forget <code class="literal">bash</code> which may be not part of NetBSD
base installation. It is not required for "legacy" builds arranged by just
<code class="literal">autogen.sh</code> and <code class="literal">configure</code> scripts.</p><p>Also note that the <code class="literal">install-sh</code> helper added by autotools from OS-provided
resources when generating the <code class="literal">configure</code> script may be old and its directory
creation mode is not safe for parallel-<code class="literal">make</code> installations. If this happens,
you can work around by <code class="literal">make MKDIRPROG="mkdir -p" install -j 8</code> for example.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><h3 class="title">Note</h3><p>Instructions below rely on <code class="literal">pkgin</code>, an <code class="literal">apt</code>/<code class="literal">yum</code>-like front-end tool for
managing pkgsrc binary packages.  It is available out of the box on the system
this document describes, but if an e.g. older release lacks it, it can be added
using the older tooling:</p><pre class="screen">:; CDN="http://cdn.NetBSD.org/pub/pkgsrc/packages/NetBSD"
:; PKG_PATH="${CDN}/$(uname -p)/$(uname -r|cut -f '1 2' -d.)/All/"
:; export PKG_PATH
:; pkg_add pkgin</pre><p>For more details, see <a class="ulink" href="https://www.pkgsrc.org/#index1h1" target="_top">https://www.pkgsrc.org/#index1h1</a> and
<a class="ulink" href="https://www.librebyte.net/en/cli-en/pkgin-a-netbsd-package-manager/" target="_top">https://www.librebyte.net/en/cli-en/pkgin-a-netbsd-package-manager/</a>
(the latter also provides a nice cheat-sheet about <code class="literal">pkgin</code> operations).</p></div><div class="note" style="margin-left: 0; margin-right: 10%;"><h3 class="title">Note</h3><p>On NetBSD 9.2 the <code class="literal">openpimi</code> and <code class="literal">net-snmp</code> packages complain that
they require either OS ABI 9.0, or that <code class="literal">CHECK_OSABI=no</code> is set in
a <code class="literal">pkg_install.conf</code>. Such file was not found in the test system,
but can be created in <code class="literal">/etc/</code> and is honoured by <code class="literal">pkgin</code>:</p><pre class="screen">:; grep CHECK_OSABI /etc/pkg_install.conf || \
    ( echo CHECK_OSABI=no &gt;&gt; /etc/pkg_install.conf )</pre></div><pre class="screen">:; pkgin install \
    git perl curl \
    mozilla-rootcerts mozilla-rootcerts-openssl \
    bmake gmake autoconf automake libltdl libtool \
    cppcheck \
    pkgconf \
    gcc7 gcc14 clang

# See comments below, python version and package naming depends on distro
:; pkgin install \
    python27 python39 python312 python313

:; ( cd /usr/pkg/bin &amp;&amp; ( ln -fs python2.7 python2 ; ln -fs python3.13 python3 ) )
# You can find a list of what is (pre-)installed with:
#   :; pkgin list | grep -Ei 'perl|python'

# For localization maintenance (currently in Python NUT-Monitor app),
# provide an `msgfmt` implementation, e.g.:
#   :; pkgin install gettext
#
# To install the Python NUT-Monitor app, you may need some modules:
# For Python2:
#   :; pkgin install py27-gtk2
# For Python3:
#   :; pkgin install py312-qt5 py313-qt5
# FIXME: Consider qt6 since 2025

# For spell-checking, highly recommended if you would propose pull requests:
:; pkgin install \
    aspell aspell-en

# For man-page doc types, footprint on this platform is moderate:
:; pkgin install \
    asciidoc

# FIXME: Missing packages?
# For other doc types (PDF, HTML) generation - massive packages (TEX, X11):
# :; pkgin install \
#    source-highlight py39-pygments dblatex

# For CGI graph generation - massive packages (X11):
:; pkgin install \
    gd openmp

:; pkgin install \
    cppunit \
    openssl nss \
    augeas \
    libusb libusb1 \
    neon \
    net-snmp \
    avahi

# Select a LUA-5.1 (or possibly 5.2?) version
:; pkgin install \
    lua51 # lua52

:; pkgin install \
    bash dash ast-ksh oksh</pre><div class="note" style="margin-left: 0; margin-right: 10%;"><h3 class="title">Note</h3><p>There seems to be no FreeIPMI for NetBSD, but there’s OpenIPMI
(can help someone implementing actual support for it):</p><pre class="screen">:; pkgin install \
    openipmi</pre><p>It still seems to not work for NUT’s expectations of FreeIPMI
(we have basic detection support for OpenIPMI but no code yet).</p></div><p>Recommended: For compatibility with common setups on other operating
systems, can add dash-number suffixed symlinks to compiler tools (e.g.
<code class="literal">gcc-7</code> beside the <code class="literal">gcc</code> installed by package) near the original
binaries and into <code class="literal">/usr/lib/ccache</code>:</p><pre class="screen">:; ( cd /usr/pkg/bin &amp;&amp; for TOOL in cpp gcc g++ ; do \
        for VER in "7" "14" ; do \
            ln -fs "../gcc$VER/bin/$TOOL" "${TOOL}-${VER}" ; \
        done ; \
     done )

# Note that the one delivered binary is `clang-13` (in originally described
# installation; `clang-18` after an update in 2025 which auto-removed the
# older version) and many (unnumbered) symlinks to it. For NUT CI style of
# support for builds with many compilers, complete the known numbers:
:; ( cd /usr/pkg/bin &amp;&amp; for TOOL in clang-cpp clang++ ; do \
        for VER in "-18" ; do \
            ln -s clang-18 "$TOOL$VER" ; \
        done ; \
     done )

:; pkgin install ccache
:; ( mkdir -p /usr/lib/ccache &amp;&amp; cd /usr/lib/ccache &amp;&amp; \
        for TOOL in cpp gcc g++ clang ; do \
            for VER in "" "-7" "-14" ; do \
                ln -s ../../pkg/bin/ccache "$TOOL$VER" ; \
            done ; \
        done ; \
        for TOOL in clang clang++ clang-cpp ; do \
            for VER in "" "-18" ; do \
                ln -s ../../pkg/bin/ccache "$TOOL$VER" ; \
            done ; \
        done ; \
   )</pre><div class="note" style="margin-left: 0; margin-right: 10%;"><h3 class="title">Note</h3><p>For Jenkins agents, also need to <code class="literal">pkgin install openjdk21</code> (will be
in <code class="literal">JAVA_HOME=/usr/pkg/java/openjdk21</code>). Note that the location may be not
exposed in <code class="literal">PATH</code> by default, so you may want to edit your system-wide
<code class="literal">/etc/profile</code> or build user’s <code class="literal">~/.profile</code> with:</p></div><pre class="screen">JAVA_HOME="/usr/pkg/java/openjdk21"
export JAVA_HOME
PATH="${JAVA_HOME}/bin:${PATH}"
export PATH</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_openindiana_as_of_releases_2021_10_to_2024_04"></a>OpenIndiana as of releases 2021.10 to 2024.04</h4></div></div></div><p>Note that due to IPS and <code class="literal">pkg(5)</code>, a version of python is part of baseline
illumos-based OS; this may not be the case on some other illumos distributions
which do not use IPS however. Currently they use python 3.7 or newer.</p><p>To build older NUT releases (2.7.4 and before), you may need to explicitly
<code class="literal">pkg install python-27</code>.</p><p>Typical tooling would include:</p><pre class="screen">:; pkg install \
    git curl wget \
    gnu-make autoconf automake libltdl libtool \
    valgrind \
    pkg-config \
    gnu-binutils developer/linker

# To debug eventual core dump files, or trace programs with an IDE like
# NetBeans (perhaps remotely), you may want the GNU Debugger program:
:; pkg install \
    gdb

# NOTE: For python, some suitable version should be available since `pkg(5)`
# tool is written in it. Similarly, many system tools are written in perl
# so some version should be installed. You may specify additional variants
# like this (numbers depending on default or additional packages of your
# distro; recommended to group `pkg` calls with many packages at once to
# save processing time for calculating a build strategy):
#   :; pkg install runtime/python-27
# and/or:
#   :; pkg install runtime/python-37 runtime/python-35 runtime/python-39
# Similarly for perl variants, e.g.:
#   :; pkg install runtime/perl-522 runtime/perl-524 runtime/perl-534
# You can find a list of what is available in remote repositories with:
#   :; pkg info -r | grep -Ei 'perl|python'

# For spell-checking, highly recommended if you would propose pull requests:
:; pkg install \
    aspell text/aspell/en

# For other doc types (man-page, PDF, HTML) generation - massive packages
# (TEX, X11):
:; pkg install \
    asciidoc libxslt \
    docbook/dtds docbook/dsssl docbook/xsl docbook docbook/sgml-common \
    pygments-39 \
    image/graphviz expect graphviz-tcl

# For CGI graph generation - massive packages (X11):
:; pkg install \
    gd

:; pkg install \
    openssl library/mozilla-nss \
    library/augeas python/augeas \
    libusb-1 libusbugen system/library/usb/libusb \
    system/header/header-usb driver/usb/ugen \
    libmodbus \
    library/neon \
    system/management/snmp/net-snmp \
    system/management/powerman \
    freeipmi \
    avahi

# With 2024.04, some packages were split for development vs. run-time
# and/or based on architecture:
:; pkg install \
    system/library/mozilla-nss/header-nss \
    library/nspr library/nspr/32

:; pkg install \
    lua

:; pkg install \
    dash bash shell/ksh93

### Maybe
:; pkg install \
    gnu-coreutils

### Maybe - after it gets fixed for GCC builds/linkage
:; pkg install \
    cppunit</pre><p>For extra compiler coverage, we can install a large selection of versions,
although to meet NUT CI farm expectations we also need to expose "numbered"
filenames, as automated below:</p><pre class="screen"># NOTE: not all compiler versions may be served, some are obsoleted over time.
# Check current distro repository offers with:
:; pkg info -r '*clang*' '*gcc*'
:; pkg search -r '*bin/g++*'
:; pkg search -r '*bin/clang++*'

:; pkg install \
    gcc-48 gcc-49 gcc-5 gcc-6 gcc-7 gcc-9 gcc-10 gcc-11 \
    clang-80 clang-90 \
    ccache

# As of this writing, clang-13 refused to link (claiming issues with
# --fuse-ld which was never specified) on OI; maybe later it will:
#:; pkg install \
#    developer/clang-13 runtime/clang-13

# With OI 2024.04 there's also clang-18 available in the mix, and as of
# 2025 packaging, clang-19 as well:
:; pkg install \
    developer/clang-19 runtime/clang-19

# Get clang-cpp-X visible in standard PATH (for CI to reference the right one),
# and make sure other frontends are exposed with versions (not all OI distro
# releases have such symlinks packaged right), e.g.:
:; (cd /usr/bin &amp;&amp; for X in 8 9 19 ; do for T in "" "++" "-cpp"; do \
    ln -fs "../clang/$X.0/bin/clang$T" "clang${T}-${X}" ; \
   done; done)

# If /usr/lib/ccache/ symlinks to compilers do not appear after package
# installation, or if you had to add links like above, call the service:
:; svcadm restart ccache-update-symlinks</pre><p>We can even include a <code class="literal">gcc-4.4.4-il</code> version (used to build the illumos OS
ecosystems, at least until recently, which is a viable example of an old
GCC baseline); but note that so far it conflicts with <code class="literal">libgd</code> builds at
<code class="literal">./configure --with-cgi</code> stage (its binaries require newer ecosystem):</p><pre class="screen">:; pkg install \
    illumos-gcc@4.4.4

# Make it visible in standard PATH
:; (cd /usr/bin &amp;&amp; for T in gcc g++ cpp ; do \
    ln -s ../../opt/gcc/4.4.4/bin/$T $T-4.4.4 ; \
   done)

# If /usr/lib/ccache/ symlinks to these do not appear, call the service:
:; svcadm restart ccache-update-symlinks</pre><p>OI currently also does not build <code class="literal">cppunit</code>-based tests well, at least
not with GCC (they segfault at run-time with <code class="literal">ostream</code> issues); a CLANG
build works for that however.</p><p>It also lacks out-of-the-box Tex suite and <code class="literal">dblatex</code> in particular, which
<code class="literal">asciidoc</code> needs to build PDF documents. It may be possible to add these
from third-party repositories (e.g. SFE) and/or build from sources.</p><p>No pre-packaged <code class="literal">cppcheck</code> was found, either.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><h3 class="title">Note</h3><p>For Jenkins agents, also need to <code class="literal">pkg install runtime/java/openjdk17</code>
for JRE/JDK 17. Java 17 or 21 is required to run Jenkins agents after
autumn 2024. If updating from older releases, you may need to update default
implementation, e.g.:</p><pre class="screen">:; pkg set-mediator -V 17 java</pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_omnios_ce_as_of_releases_151036_151052"></a>OmniOS CE (as of releases 151036 - 151052)</h4></div></div></div><p>Being a minimal-footprint system, OmniOS CE provides very few packages out
of the box. There are additional repositories supported by the project, as
well as third-party repositories such as SFE. For some dependencies, it may
happen that you would need to roll and install your own builds in accordance
with that project’s design goals.</p><p>Note you may need not just the "Core" IPS package publisher, but also the
"Extra" one. As of release 151052, it can be attached right in the installer;
otherwise the <code class="literal">pkg (set-)publisher</code> commands can be used. See OmniOS CE web
site for setup details.</p><pre class="screen"># Optionally, make the environment comfortable, e.g.:
:; pkg install sudo bash application/mc wget rsync pigz pbzip2 p7zip top

# NOTE: not all compiler versions may be served by all releases (e.g. OmniOS
# did not deliver clang in Core nor Extra repositories for quite a while),
# and some are obsoleted over time. While OmniOS 151036 lacked any clang,
# LTS 151046 offered a range of clang 13 to 17, and current stable (151052)
# includes also 18 and 19. Unlike OpenIndiana, OmniOS does not provide
# implicit default (not-numbered) packages for neither clang nor gcc.
# Check your distro repository offers with:
:; pkg info -r '*clang*' '*gcc*'
:; pkg search -r '*bin/g++*'
:; pkg search -r '*bin/clang++*'

# Then install a suitable one, e.g.:
:; pkg install \
    developer/clang-17

:; pkg install \
    developer/build/autoconf developer/build/automake \
    developer/build/libtool library/libtool/libltdl \
    build-essential ccache git developer/pkg-config \
    runtime/perl \
    asciidoc \
    libgd

# To debug eventual core dump files, or trace programs with an IDE like
# NetBeans (perhaps remotely), you may want the GNU Debugger program:
:; pkg install \
    gdb

# May be or not be provided, depending on distro age:
:; pkg install \
    net-snmp

# For crypto-enabled builds:
:; pkg install \
    openssl-3

# By r151046, some packages were split for development vs. run-time;
# to provide support for Mozilla NSS, you need libraries and headers:
:; pkg install \
    system/library/mozilla-nss \
    system/library/mozilla-nss/header-nss \
    library/nspr library/nspr/header-nspr

# NOTE: For python, some suitable version should be available since `pkg(5)`
# tool is written in it. You may specify an additional variant like this
# (numbers depending on default or additional packages of your distro):
#   :; pkg install runtime/python-37
# You can find a list of what is available in remote repositories with:
#   :; pkg info -r | grep -Ei 'perl|python'</pre><p>Your OmniOS version may lack a pre-packaged libusb, however the binary
build from contemporary OpenIndiana can be used (copy the header files
and the library+symlinks for all architectures you would need).</p><div class="note" style="margin-left: 0; margin-right: 10%;"><h3 class="title">Note</h3><p>As of July 2022, a <code class="literal">libusb-1</code> package recipe was proposed for the
<code class="literal">omnios-extra</code> repository (NUT itself and further dependencies may also
appear there, per
<a class="ulink" href="https://github.com/networkupstools/nut/issues/1498" target="_top">issue #1498</a>),
and is available as of release 151046 and later on:</p><pre class="screen">:; pkg install \
    libusb-1</pre></div><p>You may need to set up <code class="literal">ccache</code> with the same <code class="literal">/usr/lib/ccache</code> dir used
in other OS recipes. Assuming your Build Essentials pulled GCC 11 version,
and ccache is under <code class="literal">/opt/ooce</code> namespace, that would be like:</p><pre class="screen">:; GCCVER=11
:; mkdir -p /usr/lib/ccache
:; cd /usr/lib/ccache
:; ln -fs ../../../opt/ooce/bin/ccache gcc
:; ln -fs ../../../opt/ooce/bin/ccache g++
:; ln -fs ../../../opt/ooce/bin/ccache gcpp
:; ln -fs ../../../opt/ooce/bin/ccache gcc-${GCCVER}
:; ln -fs ../../../opt/ooce/bin/ccache g++-${GCCVER}
:; ln -fs ../../../opt/ooce/bin/ccache gcpp-${GCCVER}</pre><p>Given that many of the dependencies can get installed into that namespace,
you may have to specify where <code class="literal">pkg-config</code> will look for them (note that
library and binary paths can be architecture bitness-dependent; the
<code class="literal">ci_build.sh</code> script should take care of this for many scenarios):</p><pre class="screen">:; ./configure PKG_CONFIG_PATH="/opt/ooce/lib/amd64/pkgconfig" --with-cgi</pre><p>You may also have to fiddle with either <code class="literal">LD_LIBRARY_PATH</code>, <code class="literal">crle (-c)</code> or
<code class="literal">./configure --with-something-libs</code> options to compensate for lack of <code class="literal">-R</code>
linker options in the <code class="literal">pkg-config</code> information provided by that repository:
by default the NUT programs can build with the information they get, but
fail to find the needed shared objects at run-time. More about this situation
is tracked at <a class="ulink" href="https://github.com/networkupstools/nut/issues/2782" target="_top">https://github.com/networkupstools/nut/issues/2782</a></p><p>Note also that the minimal footprint nature of OmniOS CE precludes building
any large scope easily, so avoid docs and "all drivers" unless you provide
whatever they need to happen.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><h3 class="title">Note</h3><p>For Jenkins agents, also need to <code class="literal">pkg install runtime/java/openjdk21</code>
for JRE/JDK 17. Java 17 or 21 is required to run Jenkins agents after
autumn 2024. If updating from older releases, you may need to update default
implementation, e.g.:</p><pre class="screen">:; pkg set-mediator -V 21 java</pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_solaris_8"></a>Solaris 8</h4></div></div></div><p>Builds for a platform as old as this are not currently covered by regular
NUT CI farm runs, however since the very possibility of doing this was
recently verified, some notes follow.</p><p>For context: Following a discussion in the mailing list starting at
<a class="ulink" href="https://alioth-lists.debian.net/pipermail/nut-upsuser/2022-December/013051.html" target="_top">https://alioth-lists.debian.net/pipermail/nut-upsuser/2022-December/013051.html</a>
and followed up by GitHub issues and PR:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<a class="ulink" href="https://github.com/networkupstools/nut/issues/1736" target="_top">https://github.com/networkupstools/nut/issues/1736</a>
</li><li class="listitem">
<a class="ulink" href="https://github.com/networkupstools/nut/issues/1737" target="_top">https://github.com/networkupstools/nut/issues/1737</a>
  (about a possible but not yet confirmed platform problem)
</li><li class="listitem">
<a class="ulink" href="https://github.com/networkupstools/nut/pull/1738" target="_top">https://github.com/networkupstools/nut/pull/1738</a>
</li></ul></div><p>…recent NUT codebase was successfully built and self-tested in a Solaris 8
x86 VM (a circa 2002 release), confirming the project’s adherence to the
goal that if NUT ran on a platform earlier, so roughly anything POSIX-ish
released this millennium and still running, it should still be possible — at least as far as our part of equation is concerned.</p><p>That said, platform shows its age vs. later standards (script interpreters
and other tools involved), and base "complete install" lacked compilers,
so part of the tested build platform setup involved third-party provided
package repositories.</p><p>One helpful project was extensive notes about preparation of the Solaris 8 VM
(and our further comments there), which pointed to the still active "tgcware"
repository and contains scripts to help prepare the freshly installed system:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<a class="ulink" href="https://github.com/mac-65/Solaris_8_x86_VM" target="_top">https://github.com/mac-65/Solaris_8_x86_VM</a>
</li><li class="listitem">
<a class="ulink" href="https://github.com/mac-65/Solaris_8_x86_VM/issues/1" target="_top">https://github.com/mac-65/Solaris_8_x86_VM/issues/1</a>
</li><li class="listitem">
<a class="ulink" href="http://jupiterrise.com/tgcware/sunos5.8_x86/stable/" target="_top">http://jupiterrise.com/tgcware/sunos5.8_x86/stable/</a>
</li></ul></div><p>Note that scripts attached to the notes refer to older versions of the
packages than what is currently published, so I ended up downloading
everything from the repository into the VM and using shell wildcards
to pick the packages to install (mind the package families with similar
names when preparing such patterns).</p><p>After the OS, tools and feasible third-party dependencies were installed,
certain environment customization was needed to prepare for NUT build in
particular (originally detailed in GitHub issues linked above):</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
For <code class="literal">CONFIG_SHELL</code>, system <code class="literal">dtksh</code> seems to support the syntax (unlike
  default <code class="literal">/bin/sh</code>), but for some reason segfaults during <code class="literal">configure</code> tests.
  Alternatively <code class="literal">/usr/tgcware/bin/bash</code> (4.4-ish) can be used successfully.
  System-provided bash 2.x is too old for these scripts.
</li><li class="listitem">
To run <code class="literal">ci_build.sh</code> CI/dev-testing helper script, either the shebang
  should be locally fixed to explicitly call <code class="literal">/usr/tgcware/bin/bash</code>, or
  the build environment’s <code class="literal">PATH</code> should point to this <code class="literal">bash</code> implementation
  as a first hit. If we want to primarily use OS-provided tools, this latter
  option may need a bit of creative setup; I made a symlink into the
  <code class="literal">/usr/lib/ccache</code> directory which has to be first anyway (before compilers).
</li><li class="listitem">
The system-provided default <code class="literal">grep</code> lacks the <code class="literal">-E</code> option which was preferred
  over generally obsoleted <code class="literal">egrep</code> since
  <a class="ulink" href="https://github.com/networkupstools/nut/pull/1660" target="_top">PR #1660</a> — however
  pre-pending <code class="literal">/usr/xpg4/bin</code> early in the <code class="literal">PATH</code> fixes the problem.
</li><li class="listitem">
The builds of <code class="literal">gcc</code> in TGCWARE repository were picky about shared objects
  linking as needed to run them, so <code class="literal">LD_LIBRARY_PATH</code> had to refer to its
  library directories (generally this is frowned upon and should be a last
  resort).
</li><li class="listitem">
Due to lack of Python in that OS release, NUT augeas support had to be
  disabled when preparing the build from Git sources (generated files may
  be available as part of distribution tarballs however):
  <code class="literal">WITHOUT_NUT_AUGEAS=true; export WITHOUT_NUT_AUGEAS; ./autogen.sh</code>
</li></ul></div><p>Overall, the successful test build using the NUT standard CI helper script
<code class="literal">ci_build.sh</code> had the following shell session settings:</p><pre class="screen">### Common pre-sets from .profile or .bashrc (long lines wrapped for readability):
### bash-2.03$ echo $PATH
###   /usr/bin:/usr/dt/bin:/usr/openwin/bin:/bin:/usr/ucb:/usr/tgcware/bin:\
###   /usr/tgcware/gnu:/usr/tgcware/gcc42/bin:/usr/tgcware/i386-pc-solaris2.8/bin

### bash-2.03$ echo $LD_LIBRARY_PATH
###   /usr/lib:/usr/tgcware/lib:/usr/tgcware/gcc42/lib:\
###   /usr/tgcware/i386-pc-solaris2.8/lib

### Further tuning for the build itself:
:; git clean -fffdddxxx
:; CONFIG_SHELL=/usr/tgcware/bin/bash \
   WITHOUT_NUT_AUGEAS=true \
   PATH="/usr/xpg4/bin:$PATH" \
    /usr/tgcware/bin/bash ./ci_build.sh</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_macos_with_homebrew"></a>MacOS with homebrew</h4></div></div></div><p>Some CI tests happen on MacOS using a mix of their default xcode environment
for compilers, and Homebrew community packaging for dependencies (including
<code class="literal">bash</code> since the system one is too old for <code class="literal">ci_build.sh</code> script syntax).</p><p>See <code class="literal">.travis.yml</code> and <code class="literal">.circleci/config.yml</code> for practical details of the
setup, and <a class="ulink" href="https://brew.sh" target="_top">https://brew.sh</a> if you want to install it on your MacOS system
(note that its default packaged locations known as <code class="literal">HOMEBREW_PREFIX</code> differ
depending on architecture — see <a class="ulink" href="https://docs.brew.sh/Installation" target="_top">https://docs.brew.sh/Installation</a> for more
details; find via <code class="literal">brew config | grep HOMEBREW_PREFIX: | awk '{print $2}'</code>).</p><div class="note" style="margin-left: 0; margin-right: 10%;"><h3 class="title">Note</h3><p>The quickest pre-configuration for <code class="literal">ci_build.sh</code> integration with this
non-default build system would be to add this line into your shell profile:</p><pre class="screen">eval "$(brew shellenv)"</pre></div><div class="note" style="margin-left: 0; margin-right: 10%;"><h3 class="title">Note</h3><p>Homebrew is not the only build/packaging system available for MacOS,
so NUT scripts do not make any assumptions nor try to find a build system
they were not told about (via <code class="literal">HOMEBREW_PREFIX</code> in this case).</p></div><p>Currently known dependencies for basic build include:</p><pre class="screen"># Optional for a quick spin:
:; HOMEBREW_NO_AUTO_UPDATE=1; export HOMEBREW_NO_AUTO_UPDATE

# Required:
:; brew install ccache bash libtool binutils autoconf automake git m4 \
        pkg-config aspell asciidoc docbook-xsl cppunit gd \
        libusb neon net-snmp \
        nss openssl \
        libmodbus freeipmi powerman

# To debug eventual core dump files, or trace programs with an IDE like
# NetBeans (perhaps remotely), you may want the GNU Debugger program:
:; brew install gdb

# Recommended:
:; brew install curl wget midnight-commander</pre><div class="note" style="margin-left: 0; margin-right: 10%;"><h3 class="title">Note</h3><p>for <code class="literal">asciidoc</code>/<code class="literal">a2x</code> to work, you should <code class="literal">export XML_CATALOG_FILES</code> with
the location of packaged resources (<code class="literal">${HOMEBREW_PREFIX}/etc/xml/catalog</code>).
On one test system, man page builds spewed warnings like
<code class="literal">&lt;unknown&gt;:1: SyntaxWarning: invalid escape sequence '\S'</code>
due to incompatibility of older asciidoc with new Python syntax requirements,
but seemed to produce reasonable results otherwise.</p></div><p>Note that <code class="literal">ccache</code> is installed in a different location than expected by default
in the <code class="literal">ci_build.sh</code> script, so if your system allows to add the symbolic link
to <code class="literal">/opt/homebrew/opt/ccache/libexec</code> (<code class="literal">/usr/local/opt/ccache/libexec</code> on x86)
as <code class="literal">/usr/lib/ccache</code> — please do so as the easiest way out.</p><p>Alternatively, to prepare building sessions with <code class="literal">ci_build.sh</code> you can:</p><pre class="screen">:; export CI_CCACHE_SYMLINKDIR="/opt/homebrew/opt/ccache/libexec"

### ...or for x86 builders:
#:; export CI_CCACHE_SYMLINKDIR="/usr/local/opt/ccache/libexec"</pre><div class="note" style="margin-left: 0; margin-right: 10%;"><h3 class="title">Note</h3><p>For Jenkins agents, also need to <code class="literal">brew install --cask temurin@21</code>
for JRE/JDK 21. Java 17 or 21 (an LTS) is required to run Jenkins agents
after summer 2024.</p></div><p>The compiler is part of Apple’s XCode ecosystem. Just try to run <code class="literal">clang</code>
in a GUI terminal, and a pop-up will appear offering to install it.
Note that you would have to create symbolic links to version-numbered names
of compilers, e.g. <code class="literal">clang-14</code> and <code class="literal">clang++-14</code> in both <code class="literal">/usr/local/bin</code>
(pointing to <code class="literal">/bin/clang(++)</code> and in the <code class="literal">ccache</code> location prepared above
(pointing to <code class="literal">../bin/ccache</code>), and repeat that in locations prepared by
XCode installation such as <code class="literal">/Library/Developer/CommandLineTools/usr/bin/</code>
and <code class="literal">/usr/local/Homebrew/Library/Homebrew/shims/mac/super/</code> just as
<code class="literal">ln -s clang{,-14} ; ln -s clang++{,-14}</code>.  Apparently <code class="literal">clang</code> is the
only compiler available; various names of <code class="literal">gcc*</code> are links to the same
binaries.</p><div class="warning" style="margin-left: 0; margin-right: 10%;"><h3 class="title">Warning</h3><p>Take care to <span class="strong"><strong>NOT</strong></span> symlink a <code class="literal">clang-cpp(-14)</code> which is not a
name recognized by XCode dispatcher program, so requests to it freeze.</p></div><p>On a machine dedicated to CI purposes, it may be wise to disable Spotlight
search indexing with <code class="literal">sudo mdutil -a -i off</code>, disable active desktop themes,
etc. (normally you would not even log in interactively).</p><p>For scratch workers (VMs) also consider going to System Preferences ⇒
Software Updates ⇒ Advanced, and un-checking all the boxes (disable the
overheads of pulling in the updates you won’t remember in an hour anyway).</p><p>If you eventually find that the <code class="literal">kernel_task</code> consumes a lot of CPU, this
is usually the system’s way of throttling (scheduling A LOT of high-priority
no-op cycles to preempt any other workload). In this case please investigate
cooling and hardware compatibility (especially in a VM), or find and follow
community documentation about neutering <code class="literal">IOPlatformPluginFamily.kext</code> module
(probably not on the bare-metal MacOS instance — find the cooling problem
there instead).</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<a class="ulink" href="https://grafxflow.co.uk/blog/mac-os-x/delete-ioplatformpluginfamilykext-macos-big-sur" target="_top">https://grafxflow.co.uk/blog/mac-os-x/delete-ioplatformpluginfamilykext-macos-big-sur</a>
</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_windows_builds"></a>Windows builds</h4></div></div></div><p>There have been several attempts to adjust NUT codebase to native builds
for Windows, as well as there are many projects helping to produce portable
programs.</p><p>Further TODO for Windows would include:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
MSVCRT (ubiquitous) vs. UCRT (more standards compliant, but since Windows 10)
  <a class="ulink" href="https://docs.microsoft.com/en-us/cpp/porting/upgrade-your-code-to-the-universal-crt?view=msvc-160" target="_top">https://docs.microsoft.com/en-us/cpp/porting/upgrade-your-code-to-the-universal-crt?view=msvc-160</a>
</li><li class="listitem">
libusb-0.1 vs. libusb-1.0
</li></ul></div><div class="note" style="margin-left: 0; margin-right: 10%;"><h3 class="title">Note</h3><p>Native mingw, MSYS2, etc. builds on Windows are known to suffer from
interaction with antivirus software which holds executable files open and
so not writable by the linker. This may cause random steps in the <code class="literal">configure</code>
script or later during the build to fail. If that happens to you, disable the
antivirus completely or exempt at least the NUT build area from protection.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="_windows_with_mingw"></a>Windows with mingw</h5></div></div></div><p>See <code class="literal">scripts/Windows/README.adoc</code> for original recommendations for the effort,
including possibilities of cross-builds with mingw available in Linux.</p><p>Unfortunately these did not work for me at the time of testing, yielding
some issues downloading mingw both in Windows and Linux environments.
So I explored other downloads, as detailed below.</p><p>See also:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<a class="ulink" href="https://winlibs.com/" target="_top">https://winlibs.com/</a>
</li><li class="listitem">
<a class="ulink" href="https://azrael.digipen.edu/~mmead/www/public/mingw/" target="_top">https://azrael.digipen.edu/~mmead/www/public/mingw/</a>
</li><li class="listitem">
<a class="ulink" href="https://www.mingw-w64.org/downloads/" target="_top">https://www.mingw-w64.org/downloads/</a>
</li></ul></div><div class="note" style="margin-left: 0; margin-right: 10%;"><h3 class="title">Note</h3><p>Seems the mingw installer has problems with current authentication
and redirect on SourceForge. You can download and unpack 7z archives from
<a class="ulink" href="https://sourceforge.net/projects/mingw-w64/files/mingw-w64/mingw-w64-release/" target="_top">https://sourceforge.net/projects/mingw-w64/files/mingw-w64/mingw-w64-release/</a>
into e.g. <code class="literal">C:\Progra~1\mingw-w64\x86_64-8.1.0-release-posix-seh-rt_v6-rev0</code>
location on your Windows system. Then for building further NUT dependencies
see <code class="literal">scripts/Windows/README.adoc</code>.</p></div></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="_windows_with_msys2"></a>Windows with MSYS2</h5></div></div></div><p>The MSYS2 ecosystem is available at <a class="ulink" href="https://www.msys2.org/" target="_top">https://www.msys2.org/</a> and builds upon
earlier work by <a class="ulink" href="https://www.mingw-w64.org" target="_top">MinGW-w64</a> (in turn a fork
of <a class="ulink" href="https://sourceforge.net/projects/mingw/" target="_top">MinGW.org (aka mingw-w32)</a>)
and <a class="ulink" href="http://cygwin.com/" target="_top">Cygwin</a> projects, to name a few related efforts.
It also includes <code class="literal">pacman</code> similar to that in Arch Linux for easier dependency
installation, and many packages are available "out of the box" this way.</p><p>The project is currently sponsored by Microsoft and seems to be supported by
Visual Studio Code IDE for building and debugging projects, for more details
see <a class="ulink" href="https://code.visualstudio.com/docs/cpp/config-mingw" target="_top">https://code.visualstudio.com/docs/cpp/config-mingw</a></p><p>Notable pages of the project include:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<a class="ulink" href="https://www.msys2.org/" target="_top">https://www.msys2.org/</a> with current download link and first-installation
  instructions
</li><li class="listitem">
<a class="ulink" href="https://www.msys2.org/wiki/MSYS2-introduction/" target="_top">https://www.msys2.org/wiki/MSYS2-introduction/</a> for general overview
</li><li class="listitem">
<a class="ulink" href="https://packages.msys2.org/search?t=binpkg" target="_top">https://packages.msys2.org/search?t=binpkg</a> for search in package repository
</li></ul></div><p>After downloading and installing MSYS2 archive for the first time, they
suggest to start by updating the base ecosystem (using their terminal):</p><pre class="screen">:; pacman -Syu</pre><p>Wait for metadata and base package downloads, agree that all MSYS2 programs
including your terminal would be closed/restarted, and wait for this stage
to complete.</p><p>Run it again to refresh more of the ecosystem, now without restarting it:</p><pre class="screen">:; pacman -Syu</pre><p>Finally, install tools and prerequisites for building NUT; note that some
of the recommended package names are "umbrellas" for several implementations,
and the <code class="literal">pacman</code> would ask you which (or "all") to install in those cases.</p><div class="note" style="margin-left: 0; margin-right: 10%;"><h3 class="title">Note</h3><p>Suggestions below use <code class="literal">x86_64</code> generic variants where possible, and
<code class="literal">clang</code> where available to try both build toolkits on the platform. If you
want to build <code class="literal">i686</code> (32-bit) or alternate backends (e.g. <code class="literal">ucrt</code> instead
of default <code class="literal">msvcrt</code>), poke the repository search to see what is available.</p></div><div class="note" style="margin-left: 0; margin-right: 10%;"><h3 class="title">Note</h3><p>To build NUT with <code class="literal">ci_build.sh</code> (and generally — to help <code class="literal">configure</code>
script find the dependencies listed below), start the terminal session with
"MSYS2 MinGW x64" shortcut. Other options set up the environment variables
for toolkits listed in their shortcut names, and so tend to prefer "wrong"
flags and paths to dependencies (if you have several variants installed).
The "MSYS2 MinGW UCRT x64" was also reported to work.</p></div><p>To avoid toolkit variant mismatches, you may require to use their specific
builds preferentially:</p><pre class="screen">PATH="/mingw64/bin:$PATH"
export PATH</pre><p>…and also add these lines to the <code class="literal">~/.bashrc</code> file.</p><pre class="screen"># This covers most of the common FOSS development baseline, including
# python, perl, autotools, gcc, clang, git, binutils, make, pkgconf...
:; pacman -S --needed \
    base-devel mingw-w64-x86_64-toolchain \
    autoconf-wrapper automake-wrapper libtool mingw-w64-x86_64-libltdl \
    clang gcc \
    ccache mingw-w64-x86_64-ccache \
    git aspell aspell-en \
    vim python \
    mingw-w64-x86_64-python-pygments

# PThreads come as an extra feature; note there are many variants,
# see https://packages.msys2.org/search?t=binpkg&amp;q=pthread
:; pacman -S --needed \
    mingw-w64-x86_64-winpthreads-git \
    mingw-w64-clang-x86_64-winpthreads-git

# Note that MSYS2 includes libusb-1.0 "natively"
# The NUT codebase adjustments for Windows might at this moment expect older
# ecosystem via https://github.com/mcuee/libusb-win32 -- subject to fix then.
:; pacman -S --needed \
    mingw-w64-x86_64-libusb \
    mingw-w64-clang-x86_64-libusb

# Seems that the older libusb-win32 (libusb-0.1) is also available as:
:; pacman -S --needed \
    mingw-w64-x86_64-libusb-win32 \
    mingw-w64-clang-x86_64-libusb-win32

# Alternately there is libusb-compat (libusb-1.0 codebase exposing the older
# libusb-0.1 API) which SHOULD NOT be installed along with the real libusb-0.1:
# :; pacman -S --needed mingw-w64-x86_64-libusb-compat-git \
#        mingw-w64-clang-x86_64-libusb-compat-git

# This also pulls *-devel of several other projects:
:; pacman -S --needed \
    mingw-w64-x86_64-neon libneon-devel

# Other dependencies:
:; pacman -S --needed \
    mingw-w64-x86_64-libmodbus-git \
    mingw-w64-clang-x86_64-libmodbus-git \
    mingw-w64-x86_64-libgd \
    mingw-w64-clang-x86_64-libgd

# For C++ tests:
:; pacman -S --needed \
    mingw-w64-x86_64-cppunit \
    mingw-w64-clang-x86_64-cppunit</pre><p><code class="literal">ccache</code> wrapper scripts are available as e.g. <code class="literal">/mingw64/lib/ccache/bin/gcc</code>
and lack a set for <code class="literal">clang</code> tools; easy-peasy fix with:</p><pre class="screen">:; cd /mingw64/lib/ccache/bin
:; for T in clang clang++ clang-cpp ; do \
    sed "s/gcc/$T/" &lt; gcc &gt; "$T" ; chmod +x "$T" ; done</pre><p>Note that default <code class="literal">ccache</code> seems quirky on Windows MSYS2, possibly due to
mixing of the path separator characters and/or embedding and choking on
the <code class="literal">C:</code> in path names. Overall it seems unable to create the cache files
after it has created the cache directory tree (though you might have to
pre-create the <code class="literal">${HOME}/.ccache</code> anyway, as NUT <code class="literal">ci_build.sh</code> script does.
As found in experimentation, setting the <code class="literal">PATH</code> consistently for toolkits
involved is very important.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<a class="ulink" href="https://github.com/ccache/ccache/discussions/784" target="_top">https://github.com/ccache/ccache/discussions/784</a>
</li><li class="listitem">
<a class="ulink" href="https://sourceforge.net/p/msys2/tickets/253/" target="_top">https://sourceforge.net/p/msys2/tickets/253/</a>
</li></ul></div><p>Notable packages <span class="strong"><strong>not found</strong></span> in the repo:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
snmp (net-snmp, ucd-snmp) — instructions in <code class="literal">scripts/Windows/README.adoc</code>
  document now covers building it from source in MSYS2 MinGW x64 environment,
  essentially same as for Linux cross builds with proper <code class="literal">ARCH</code> and <code class="literal">PREFIX</code>
</li><li class="listitem">
libregex (C version, direct NUT <code class="literal">configure</code> script support was added by
  the Windows branch); MSYS2 however includes <code class="literal">libpcre</code> pulled by some
  of the dependencies above…
</li><li class="listitem">
augeas
</li><li class="listitem">
avahi
</li><li class="listitem">
powerman
</li><li class="listitem">
ipmi
</li></ul></div><p>Not installed above (yet?):</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<a class="ulink" href="https://packages.msys2.org/search?t=binpkg&amp;q=serial" target="_top">https://packages.msys2.org/search?t=binpkg&amp;q=serial</a>
  — for these need to first check if termios is part of baseline
</li></ul></div><p>Note that <code class="literal">ccache</code> symlinks for MSYS2 are installed into <code class="literal">/usr/lib/ccache/bin</code>
directory (not plain <code class="literal">/usr/lib/ccache</code> as elsewhere).</p><div class="note" style="margin-left: 0; margin-right: 10%;"><h3 class="title">Note</h3><p>After you successfully build NUT (perhaps using <code class="literal">ci_build.sh</code>), if you
install it into a prototype area by <code class="literal">make DESTDIR=... install</code> then you should
add the third-party shared libraries involved, for that file set to be usable.</p><p>Something along these lines:</p><pre class="screen">:; find "$DESTDIR" -name '*.exe' -type f  | while read F ; do ldd "$F" \
   | grep ' /mingw64/' ; done  | awk '{print $3}' | sort | uniq \
   | while read LIB ; do cp -pf "$LIB" "$DESTDIR/mingw64/bin/" ; done</pre><p>Keep in mind that a similar trick (or links to <code class="literal">*.dll</code> — and symlinks are
problematic on that platform) may be needed in other directories, such as
<code class="literal">sbin</code> and <code class="literal">cgi-bin</code>:</p><pre class="screen">:; ( cd "$DESTDIR/mingw64/bin/" &amp;&amp; ln *.dll ../sbin &amp;&amp; ln *.dll ../cgi-bin )</pre></div></div></div></div></div><div xmlns="" class="navfooter nut_footer"><hr />
		Last updated 2025-07-18 23:44:41 -- Network UPS Tools 2.8.3.707</div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="_continuous_integration_nut_ci_farm_build_agent_preparation.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> </td></tr><tr><td width="40%" align="left" valign="top"> </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> </td></tr></table></div></body></html>