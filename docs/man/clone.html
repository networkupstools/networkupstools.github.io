<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 10.2.0" />
<title>CLONE(8)</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}
pre {
  white-space: pre-wrap;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; vertical-align: text-bottom; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overridden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}


</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install();
/*]]>*/
</script>
<meta name="format-detection" content="telephone=no" />
</head>
<body class="article">
<div id="header">
<h1>CLONE(8)</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="_name">NAME</h2>
<div class="sectionbody">
<div class="paragraph"><p>clone - clone an UPS, treating its outlet as if it were an UPS (with shutdown INSTCMD support)</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_synopsis">SYNOPSIS</h2>
<div class="sectionbody">
<div class="paragraph"><p><strong>clone</strong> -h</p></div>
<div class="paragraph"><p><strong>clone</strong> -a <em>UPS_NAME</em> [<em>OPTIONS</em>]</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">This man page only documents the specific features of the
clone driver.  For information about the core driver, see
<a href="nutupsdrv.html">nutupsdrv(8)</a>.</td>
</tr></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_description">DESCRIPTION</h2>
<div class="sectionbody">
<div class="paragraph"><p>This driver, which sits on top of another driver socket, allows users to group
clients to a particular outlet of a device and deal with this output as if it
were a normal UPS.  Unlike the <a href="clone-outlet.html">clone-outlet(8)</a> driver, this driver
represents a manageable device for that can be used both for monitoring and
for client computer and UPS/ePDU outlet shutdowns (it supports sending
relevant instant commands during run time).</p></div>
<div class="paragraph"><p>Unlike <a href="dummy-ups.html">dummy-ups(8)</a>, this driver does not require a running <code>upsd</code>
data server nor use the networked NUT protocol to talk to the "real" driver
(which may be remote in case of <code>dummy-ups</code> repeater mode).</p></div>
<div class="paragraph"><p>This driver does not create a completely new virtual device, but replaces or
extends some of the original readings reported by the "real" driver using
information from the specified outlet, and relays all other readings as they
were.</p></div>
<div class="paragraph"><p>Remote clients like <code>upsmon</code> can <code>MONITOR</code> the device entry presented by the
data server with this driver (and the "real" driver) running and published.</p></div>
<div class="paragraph"><p>A larger deployment with one or more lower-priority devices collected on a
manageable outlet of an UPS or ePDU would likely see several drivers set
up on the system actually capable of interactions with the UPS and running
the NUT data server <a href="upsd.html">upsd(8)</a> (and likely powered by another outlet):</p></div>
<div class="ulist"><ul>
<li>
<p>
a "real" driver talking to the UPS;
</p>
</li>
<li>
<p>
a <code>clone</code> driver talking to the "real" driver and issuing outlet power-off
  (or power-cycle) based on relatively high thresholds for remaining battery
  charge and/or runtime of the actual UPS (or explicit instant commands),
  with such operations first setting the respective timers for the outlet
  on the "real" driver, and the "FSD" flag among states of the virtual UPS
  status;
</p>
</li>
<li>
<p>
possibly a <code>clone-outlet</code> driver which is read-only and interprets the
  outlet timer values as triggers for "FSD" or "OFF" flags reported among
  states of the virtual UPS status.
</p>
</li>
</ul></div>
<div class="paragraph"><p>With this approach, the lower-priority systems collected on such outlet
would run the NUT <a href="upsmon.html">upsmon(8)</a> client to <code>MONITOR</code> the virtual UPS
presented by the read-only <code>clone-outlet</code> driver and shut down as soon as
the "FSD" flag is raised (fairly early, based on charge and/or runtime
thresholds configured for that driver) allowing the higher-priority devices
(likely including the NUT server) to enjoy a longer on-battery life.</p></div>
<div class="paragraph"><p>The <code>clone</code> driver responsible for outlet power state changes would not
normally be monitored directly (e.g. to avoid unfortunate direct shutdown
requests from those clients), although it can be (instead of <code>clone-outlet</code>)
in sufficiently trusted networks.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_extra_arguments">EXTRA ARGUMENTS</h2>
<div class="sectionbody">
<div class="paragraph"><p>This driver supports the following settings:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<strong>port</strong>=<em>drivername-devicename</em>
</dt>
<dd>
<p>
Required. The standard NUT driver <code>port</code> setting, here it provides the name
of the local Unix socket (or named Windows pipe) for connection to the "real"
driver.
</p>
</dd>
<dt class="hdlist1">
<strong>load.off</strong>=<em>command</em>
</dt>
<dd>
<p>
Recommended.  Set the command on the "real" UPS driver that will be used to
switch off the outlet.  You need both <strong>load.off</strong> and <strong>load.on</strong> in
order to power cycle the outlet.  Otherwise, shutting down the clients
powered by an outlet is a one way street (see <a href="#_important">IMPORTANT</a>).
</p>
</dd>
<dt class="hdlist1">
<strong>load.on</strong>=<em>command</em>
</dt>
<dd>
<p>
Recommended.  Set the command on the "real" UPS driver that will be used to
switch on the outlet.  You need both <strong>load.off</strong> and <strong>load.on</strong> in
order to power cycle the outlet.  Otherwise, shutting down the clients
powered by an outlet is a one way street (see <a href="#_important">IMPORTANT</a>).
</p>
</dd>
<dt class="hdlist1">
<strong>load.status</strong>=<em>value</em>
</dt>
<dd>
<p>
Recommended.  Set the variable on the "real" UPS driver that will be used
to indicate the outlet status (i.e. on/off).  If not specified, the clone
driver will attempt to keep track of the outlet status, but this is less
reliable.
</p>
</dd>
<dt class="hdlist1">
<strong>offdelay</strong>=<em>num</em>
</dt>
<dd>
<p>
Set the timer (in seconds) before the outlet is turned off after the
shutdown condition (<code>OB LB</code>) for this outlet is met or a command to shutdown
was issued.  Defaults to 120 seconds.
</p>
</dd>
<dt class="hdlist1">
<strong>ondelay</strong>=<em>num</em>
</dt>
<dd>
<p>
Set the timer (in seconds) for the outlet to switch on in case the power
returns after the outlet has been switched off.  Defaults to 30 seconds.
</p>
</dd>
<dt class="hdlist1">
<strong>mincharge</strong>=<em>value</em>
</dt>
<dd>
<p>
Set the remaining battery level when the clone UPS switches to LB
(percent).
</p>
</dd>
<dt class="hdlist1">
<strong>minruntime</strong>=<em>value</em>
</dt>
<dd>
<p>
Set the remaining battery runtime when the clone UPS switches to LB
(seconds).
</p>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation">IMPLEMENTATION</h2>
<div class="sectionbody">
<div class="paragraph"><p>The port specification in the <a href="ups.conf.html">ups.conf(5)</a> should reference the
local driver socket (or Windows named pipe) that the "real" UPS driver
is using. For example:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>  [realups]
     driver = usbhid-ups
     port = auto

  [clone-outlet-1]
     driver = clone
     port = usbhid-ups-realups
     load.on = outlet.1.load.on
     load.off = outlet.1.load.off
     load.status = outlet.1.status
     desc = "Outlet 1 of the Real UPS"
     [...]</code></pre>
</div></div>
<div class="paragraph"><p>This driver supports instant commands to initiate a forced shutdown for
<code>upsmon</code> or similar clients which <code>MONITOR</code> this virtual UPS device, if
the outlet status is currently <em>on</em> and no other shutdown was initiated
yet (setting the virtual UPS shutdown delay timer to <code>offdelay</code> and
issuing an FSD via <code>ups.status</code>):</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>shutdown.return</code>&#8201;&#8212;&#8201;power the outlet back on after <code>ondelay</code>;
</p>
</li>
<li>
<p>
<code>shutdown.stayoff</code>&#8201;&#8212;&#8201;keep the outlet <em>off</em>.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Such commands are propagated to the "real" driver using the NUT socket
protocol (using command names specified in the <code>load.off</code> and <code>load.on</code>
driver configuration options), if the shutdown or start timers are set
at the moment, or if the "real" device is not "online" and its known
battery charge or runtime are below the configured "low" thresholds.</p></div>
<div class="paragraph"><p>The outlet status is determined using the name specified by the
<code>load.status</code> driver option if set, or is just assumed by latest
completed shutdown/start operation (using unknown outlet number).</p></div>
<div class="paragraph"><p>The driver does not support a common NUT device shutdown operation as
such (<code>clone -k</code> just prints an error and bails out).</p></div>
<div class="paragraph"><p>This driver also supports setting certain NUT variables at run-time:</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>battery.charge.low</code>&#8201;&#8212;&#8201;see <code>mincharge</code> in driver options;
</p>
</li>
<li>
<p>
<code>battery.runtime.low</code>&#8201;&#8212;&#8201;see <code>minruntime</code> in driver options.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Compared to the "real" driver&#8217;s readings, this driver also adds
(or overrides) the following data points: <code>ups.delay.shutdown</code>,
<code>ups.delay.start</code>, <code>ups.timer.shutdown</code> and <code>ups.timer.start</code>.
It keeps track of "real" driver&#8217;s values of <code>battery.charge</code> and
<code>battery.runtime</code> (actual current readings) to decide on automated
outlet shutdown later on.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_important">IMPORTANT</h2>
<div class="sectionbody">
<div class="paragraph"><p>Unlike a real UPS, you should <strong>not</strong> configure a upsmon primary mode for this
driver.  When a upsmon primary sees the OB LB flags and tells the upsd server
it is OK to initiate the shutdown sequence, the server will latch the FSD
status and it will not be possible to restart the systems connected without
restarting the upsd server.</p></div>
<div class="paragraph"><p>This will be a problem if the power returns after the clone UPS initiated
the shutdown sequence on it&#8217;s outlet, but returns before the real UPS begins
shutting down. The solution is in the clone driver, that will insert the
FSD flag if needed without the help of a upsmon primary.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_caveats">CAVEATS</h2>
<div class="sectionbody">
<div class="paragraph"><p>The clone UPS will follow the status on the real UPS driver.  You can only
make the clone UPS shutdown earlier than the real UPS driver, not later.
If the real UPS driver initiates a shutdown, the clone UPS driver will
immediately follow.</p></div>
<div class="paragraph"><p>Be aware that the commands to shutdown/restart an outlet on the real UPS
drivers are not affected, so if you tell the real UPS driver to shutdown
the outlet of the clone UPS driver, your clients will lose power without
warning.</p></div>
<div class="paragraph"><p>If you use service management frameworks like systemd or SMF to manage the
dependencies between driver instances and other units, then you may have
to set up special dependencies (e.g. with systemd "drop-in" snippet files)
to queue your <code>clone</code> drivers to start after the "real" device drivers.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_author">AUTHOR</h2>
<div class="sectionbody">
<div class="paragraph"><p>Arjen de Korte &lt;<a href="mailto:adkorte-guest@alioth.debian.org">adkorte-guest@alioth.debian.org</a>&gt;</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_see_also">SEE ALSO</h2>
<div class="sectionbody">
<div class="paragraph"><p><a href="upscmd.html">upscmd(1)</a>,
<a href="upsrw.html">upsrw(1)</a>,
<a href="ups.conf.html">ups.conf(5)</a>,
<a href="clone-outlet.html">clone-outlet(8)</a>,
<a href="nutupsdrv.html">nutupsdrv(8)</a></p></div>
<div class="sect2">
<h3 id="_dummy_driver">Dummy driver:</h3>
<div class="paragraph"><p>The "repeater" mode of <em>dummy-ups</em> driver is in some ways similar to the
<em>clone</em> and <em>clone-outlet</em> drivers, by relaying information from a locally
or remotely running "real" device driver (and NUT data server).</p></div>
<div class="paragraph"><p><a href="dummy-ups.html">dummy-ups(8)</a></p></div>
</div>
<div class="sect2">
<h3 id="_internet_resources">Internet Resources:</h3>
<div class="paragraph"><p>The NUT (Network UPS Tools) home page: <a href="https://www.networkupstools.org/">https://www.networkupstools.org/</a></p></div>
</div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated 2025-01-15 23:48:03 UTC -- Network UPS Tools 2.8.2.1898
</div>
</div>
</body>
</html>
