<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 10.2.0" />
<title>HUAWEI-UPS2000(8)</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}
pre {
  white-space: pre-wrap;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; vertical-align: text-bottom; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overridden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}


</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install();
/*]]>*/
</script>
<meta name="format-detection" content="telephone=no" />
</head>
<body class="article">
<div id="header">
<h1>HUAWEI-UPS2000(8)</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="_name">NAME</h2>
<div class="sectionbody">
<div class="paragraph"><p>huawei-ups2000 - Driver for Huawei UPS2000 (1kVA-3kVA) UPS with USB or
RS-232 serial Modbus connection.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_synopsis">SYNOPSIS</h2>
<div class="sectionbody">
<div class="paragraph"><p><strong>huawei-ups2000</strong> -h</p></div>
<div class="paragraph"><p><strong>huawei-ups2000</strong> -a <em>DEVICE_NAME</em> [<em>OPTIONS</em>]</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">This man page only documents the hardware-specific features of the
huawei-ups2000 driver.  For information about the core driver, see
<a href="nutupsdrv.html">nutupsdrv(8)</a>.</td>
</tr></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_supported_hardware">SUPPORTED HARDWARE</h2>
<div class="sectionbody">
<div class="paragraph"><p>This driver supports Huawei UPS2000 series, online (double conversion)
UPS with the following characteristics.</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Output power: 1 kVA to 3 kVA (higher power models are unsupported).
</p>
</li>
<li>
<p>
Connection: USB or RS-232 (for most UPS models, USB is only supported
on Linux 5.12 and newer kernels, but there are exceptions, read the section
<strong>Cabling</strong> carefully).
</p>
</li>
</ol></div>
<div class="paragraph"><p>The UPS2000 series has two variants: UPS2000-A with a tower chassis,
and UPS2000-G with a rack-mount chassis. Within these two variants,
there are also two sub-variants: a standard runtime model powered by
an internal battery pack denoted by an "S" suffix, and a long runtime
model powered by an external battery pack denoted by an "L" suffix.</p></div>
<div class="paragraph"><p>All of these models should be equally supported, but more testers are
needed. Currently, it has been tested on the following models.</p></div>
<div class="ulist"><ul>
<li>
<p>
UPS2000-A-1KTTS (firmware: UPS2000A, V2R1C1SPC40, P1.0-D1.0)
</p>
</li>
<li>
<p>
UPS2000-A-1KTTS (firmware: UPS2000A, V2R1C1SPC50, P1.0-D1.0)
</p>
</li>
<li>
<p>
UPS2000-A-2KTTS (firmware: UPS2000A, V2R1C1SPC50, P1.0-D1.0)
</p>
</li>
<li>
<p>
UPS2000-G-1KRTS (firmware: UPS2000A, V2R1C1SPC40, P1.0-D1.0)
</p>
</li>
<li>
<p>
UPS2000-G-1KRTS (firmware: UPS2000G, V2R1C1SPC50, P1.0-D1.0)
</p>
</li>
<li>
<p>
UPS2000-G-3KRTS (firmware: UPS2000A, V2R1C1SPC40, P1.0-D1.0)
</p>
</li>
<li>
<p>
UPS2000-G-3KRTS (firmware: UPS2000G, V2R1C1SPC50, P1.0-D1.0)
</p>
</li>
<li>
<p>
UPS2000-G-3KRTL (firmware: UPS2000A, V2R1C1SPC40, P1.0-D1.0)
</p>
</li>
</ul></div>
<div class="paragraph"><p>If your model is not in the list, we encourage you to report successful
or unsuccessful results to the bug tracker or the mailing list.
Make sure to include the full model number of your UPS manually
in your report, because many units only report themselves as "UPS2000-A"
regardless of their models, including the G series.</p></div>
<div class="paragraph"><p>As of 2022, there is also a new hardware variant with a WCH CH341
USB-to-serial chip instead of a MaxLinear/Exar RX21V1410 chip and
reports itself as "UPS2000G". Driver support has been added since
v0.03.</p></div>
<div class="paragraph"><p>huawei-ups2000 uses the libmodbus project, for Modbus implementation.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_cabling">CABLING</h2>
<div class="sectionbody">
<div class="paragraph"><p>The UPS has a USB port and a RS-232 port. Both are supported, but on
most UPS models, USB is only usable on Linux 5.12 and later, via the
<strong>xr_serial</strong> kernel module. But for the newer hardware variant with a
WCH CH341 chip, it should have better compatibility via the <strong>ch341</strong>
kernel module. See subsection <strong>USB</strong> for details. On the other hand,
RS-232 is always supported on all operating systems.</p></div>
<div class="paragraph"><p>Only one port can be used at a time. When USB is used, RS-232 should be
unplugged from the UPS, and vice versa. Further, optional adapter cards,
such as RS-485 or SNMP, are not supported. They should be removed from
the UPS.</p></div>
<div class="paragraph"><p>Because the UPS port can be unresponsive under certain circumstances, it&#8217;s
recommended to power cycle your UPS after making a cabling change, especially
after changing the port type. That is, turn off the UPS power output via the
front panel, then unplug the UPS from line power input.  Wait for the LCD
screen to go black. Finally reconnect line power and restart your UPS.</p></div>
<div class="sect2">
<h3 id="_usb">USB</h3>
<div class="paragraph"><p>The USB port on the UPS2000 is originally powered by a MaxLinear/Exar
RX21V1410 USB-to-serial converter chip, it&#8217;s only supported by Linux
5.12 or newer, via the <strong>xr_serial</strong> kernel module. Its <strong>lsusb</strong> report
is:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>04e2:1410 Exar Corp. XR21V1410 USB-UART IC</code></pre>
</div></div>
<div class="paragraph"><p>However, a recent hardware variant switched to the WCH CH341 serial
chip:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>1a86:5523 QinHeng Electronics CH341 in serial mode, usb to serial port converter</code></pre>
</div></div>
<div class="paragraph"><p>If your unit has a WCH CH341 chip (likely only found in units made
after 2022), when the UPS2000 is connected via USB, you should see
the following logs in <strong>dmesg</strong>.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>ch341 2-1.2:1.0: ch341-uart converter detected
usb 2-1.2: ch341-uart converter now attached to ttyUSB0</code></pre>
</div></div>
<div class="paragraph"><p>If so, you should be able to proceed without worrying about kernel
compatibility. This CH341 chip has been around for a decade and should be
compatible with your system.</p></div>
<div class="paragraph"><p>On the other hand, if your unit has a MaxLinear/Exar XR21V1410 chip, like
most users do, when the UPS2000 is connected via USB to a supported Linux
system, you should see the following logs in <strong>dmesg</strong>.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>xr_serial 1-1.2:1.1: xr_serial converter detected
usb 1-1.2: xr_serial converter now attached to ttyUSB0</code></pre>
</div></div>
<div class="paragraph"><p>The driver must be <strong>xr_serial</strong>. If your system doesn&#8217;t have the
necessary device driver, you will get this message instead:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>cdc_acm 1-1.2:1.0: ttyACM0: USB ACM device</code></pre>
</div></div>
<div class="paragraph"><p>The generic driver <strong>cdc_acm</strong> is incompatible and cannot be used.
You should upgrade your Linux kernel to Linux 5.12 or newer.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">On an unsupported system, the XR21V1410 USB device can still
be recognized as a USB ACM device, but communication is impossible,
please don&#8217;t waste your time on <strong>cdc_acm</strong>.</td>
</tr></table>
</div>
<div class="paragraph"><p>If you&#8217;re already running on Linux 5.12 or newer kernels, but still
cannot see the <strong>xr_serial</strong> driver, it means the driver is not enabled
in your kernel build. If you&#8217;re a regular user, you should file a bug
report to your Linux distro maintainers and ask them to enable
<strong>xr_serial</strong> (kernel option <code>CONFIG_USB_SERIAL_XR</code>).</p></div>
<div class="paragraph"><p>When upgrading the Linux kernel isn&#8217;t an option, or when you are using
another operating system (e.g. FreeBSD), RS-232 must be used. Even for
CH341 users, one can try this option if USB somehow refuses to work.</p></div>
</div>
<div class="sect2">
<h3 id="_rs_232">RS-232</h3>
<div class="paragraph"><p>RS-232 is supported on all operating systems, either via a built-in serial
port on your computer, or by using an external USB-to-RS-232 converter. If
you plan to use an USB-to-RS-232 converter, make sure it&#8217;s supported by your
operating system.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation">INSTALLATION</h2>
<div class="sectionbody">
<div class="paragraph"><p>This driver may be not built by default.  You can build it by installing libmodbus
(with development packages) and running</p></div>
<div class="literalblock">
<div class="content">
<pre><code>configure --with-serial=yes --with-modbus=yes</code></pre>
</div></div>
<div class="paragraph"><p>You also need to give proper (R/W) permissions on the local serial device file
to allow the NUT driver run-time user to access it. This may need additional
setup for start-up scripting, udev or upower rules, to apply the rights on every
boot&#8201;&#8212;&#8201;especially if your device nodes are tracked by a virtual filesystem.</p></div>
<div class="paragraph"><p>For example, a USB-to-serial converter can be identified as <code>/dev/ttyACM0</code>
or <code>/dev/ttyUSB0</code> on Linux, or <code>/dev/ttyU0</code> on FreeBSD (note the capital "U").
A built-in serial port can be identified as <code>/dev/ttyS0</code> on Linux or one of
<code>/dev/cua*</code> names on FreeBSD.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_extra_arguments">EXTRA ARGUMENTS</h2>
<div class="sectionbody">
<div class="paragraph"><p>This driver supports the following optional settings in the
<a href="ups.conf.html">ups.conf(5)</a> file:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<strong>offdelay=</strong><em>value</em>
</dt>
<dd>
<p>
Time to wait before shutting down the UPS (seconds), acceptable range is
6 seconds (0.1 minutes) to 5940 seconds (99 minutes). Defaults to 60 seconds.
Must be a multiple of 6 seconds. To ensure your system has adequate time
to shut down after a power failure, it&#8217;s highly recommended to adjust
<strong>offdelay</strong>.
</p>
</dd>
<dt class="hdlist1">
<strong>rebootdelay=</strong><em>value</em>
</dt>
<dd>
<p>
Time to wait before rebooting the UPS (seconds), acceptable range is
6 seconds (0.1 minutes) to 5940 seconds (99 minutes). Defaults to 60 seconds.
Must be a multiple of 6 seconds. This is used by the <strong>shutdown.reboot.graceful</strong>
instant command. If you&#8217;ve adjusted <strong>offdelay</strong>, you should also adjust
<strong>rebootdelay</strong>.
</p>
</dd>
<dt class="hdlist1">
<strong>ondelay=</strong><em>value</em>
</dt>
<dd>
<p>
Time to wait before switching on the UPS (seconds), acceptable range is
60 seconds (1 minutes) to 5940 seconds (99 minutes). Defaults to 60 seconds.
Must be a multiple of 60 seconds (not 6 seconds). You don&#8217;t need to adjust
this delay unless you have special requirements.
</p>
</dd>
</dl></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Due to hardware limitation, in this driver, <strong>ondelay</strong> is respected
only when line power is available. If a power failure has occurred, the
UPS and the load is always immediately switched on, as soon (or as late)
as line power is restored.</td>
</tr></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_instant_commands">INSTANT COMMANDS</h2>
<div class="sectionbody">
<div class="paragraph"><p>This driver supports some instant commands (see <a href="upscmd.html">upscmd(8)</a>):</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<strong>shutdown.stayoff</strong>
</dt>
<dd>
<p>
After an <strong>offdelay</strong>, turn off the load. When line power is back,
remain off.
</p>
</dd>
<dt class="hdlist1">
<strong>shutdown.return</strong>
</dt>
<dd>
<p>
After an <strong>offdelay</strong>, turn off the load. When line power is back,
turn on the load, possibly after an <strong>ondelay</strong>.
</p>
</dd>
</dl></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Normally, the load is turned on as soon as line power is back.
But if line power is never lost, or has came back unexpectedly
in the middle of an ongoing shutdown (an undesirable "power race"
condition that many entry-level products on the market fail to
recover from), the load is turned on after an <strong>ondelay</strong>. Thus,
UPS2000 is unaffected by a power race, the load is guaranteed to
always restart.</td>
</tr></table>
</div>
<div class="dlist"><dl>
<dt class="hdlist1">
<strong>shutdown.reboot</strong>
</dt>
<dd>
<p>
Like <strong>shutdown.return</strong>, except that the load is turned off immediately
(6 seconds in this implementation).
</p>
</dd>
<dt class="hdlist1">
<strong>shutdown.reboot.graceful</strong>
</dt>
<dd>
<p>
Like <strong>shutdown.return</strong>, except that the load is turned off after a
<strong>rebootdelay</strong>, not an <strong>offdelay</strong>.
</p>
</dd>
<dt class="hdlist1">
<strong>beeper.enable</strong>
</dt>
<dd>
<p>
Enable the UPS beeper.
</p>
</dd>
<dt class="hdlist1">
<strong>beeper.disable</strong>
</dt>
<dd>
<p>
Disable the UPS beeper.
</p>
</dd>
<dt class="hdlist1">
<strong>beeper.toggle</strong>
</dt>
<dd>
<p>
Toggle the UPS beeper.
</p>
</dd>
<dt class="hdlist1">
<strong>bypass.start</strong>
</dt>
<dd>
<p>
Put the UPS in bypass mode. Use with caution. It exposes your equipment
to unregulated line power and provides no protection from power failures.
Also, the UPS may shut down whenever the bypass input voltage is out
of the nominal range. As a warning, the UPS beeps once every 10 seconds
in bypass mode.
</p>
</dd>
</dl></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">The driver has a basic foolproof mechanism. If the bypass input
is already abnormal due to a power failure, the driver refuses to enter
bypass mode by aborting the command and logging an error. However, it
offers no protection after the UPS has entered (or in the middle of
entering) bypass mode. Thus, again, use with caution.</td>
</tr></table>
</div>
<div class="dlist"><dl>
<dt class="hdlist1">
<strong>bypass.stop</strong>
</dt>
<dd>
<p>
Put the UPS out of bypass mode.
</p>
</dd>
<dt class="hdlist1">
<strong>load.on</strong>
</dt>
<dd>
<p>
Turn on the load immediately.
</p>
</dd>
<dt class="hdlist1">
<strong>load.off</strong>
</dt>
<dd>
<p>
Turn off the load immediately. Use with caution, everything on the UPS
will lost power.
</p>
</dd>
<dt class="hdlist1">
<strong>test.battery.start.quick</strong>
</dt>
<dd>
<p>
Perform a short battery test.
</p>
</dd>
<dt class="hdlist1">
<strong>test.battery.start.deep</strong>
</dt>
<dd>
<p>
Perform a long battery test.
</p>
</dd>
<dt class="hdlist1">
<strong>test.battery.stop</strong>
</dt>
<dd>
<p>
Stop a running battery test.
</p>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_variables">VARIABLES</h2>
<div class="sectionbody">
<div class="paragraph"><p>This driver supports some writable runtime variables (see <a href="upsrw.html">upsrw(8)</a>):</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<strong>ups.beeper.status</strong>
</dt>
<dd>
<p>
Enable or disable the UPS beeper, <strong>disabled</strong> or <strong>enabled</strong>.
</p>
</dd>
</dl></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">The beeper can only be disabled completely, it cannot be
temporally muted until the next alarm, but the option <strong>muted</strong> is
also accepted for convenience, <strong>muted</strong> is treated as an alias of
<strong>disabled</strong>.</td>
</tr></table>
</div>
<div class="dlist"><dl>
<dt class="hdlist1">
<strong>ups.delay.shutdown</strong>
</dt>
<dd>
<p>
Seconds to wait after shutdown with delay command. It&#8217;s the runtime
equivalent of <strong>offdelay</strong>. See description of <strong>offdelay</strong>.
</p>
</dd>
<dt class="hdlist1">
<strong>ups.delay.reboot</strong>
</dt>
<dd>
<p>
Seconds to wait before rebooting the UPS, it&#8217;s the runtime
equivalent of <strong>rebootdelay</strong>. See description of <strong>rebootdelay</strong>.
</p>
</dd>
<dt class="hdlist1">
<strong>ups.delay.start</strong>
</dt>
<dd>
<p>
Seconds to wait before restarting the load, it&#8217;s the runtime
equivalent of <strong>ondelay</strong>. See description of <strong>ondelay</strong>.
</p>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_known_issues_and_bugs">KNOWN ISSUES AND BUGS</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_battery_status_has_a_non_fatal_read_failure">Battery status has a non-fatal read failure</h3>
<div class="paragraph"><p>It&#8217;s usually harmless and can be safely ignored. It&#8217;s only logged for
informative purposes (<strong>LOG_INFO</strong>), not as a warning or error.</p></div>
</div>
<div class="sect2">
<h3 id="_data_stale">Data stale</h3>
<div class="paragraph"><p>Under certain circumstances, some registers can return invalid values
and trigger a "data stale" error. Once a data stale error has occurred,
you should see error messages similar to the example below in the system
log.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>huawei-ups2000: register 2002 has invalid value a000,
upsd: Data for UPS [huawei] is stale - check driver
upsd: UPS [huawei] data is no longer stale</code></pre>
</div></div>
<div class="paragraph"><p>So far all known problems have been fixed by the author, but an unknown one
cannot be ruled out. If you have encountered "data stale" problems during
normal uses, please file a bug report with full logs attached.</p></div>
<div class="paragraph"><p>Before troubleshooting or reporting a problem, it&#8217;s important to check
your <strong>dmesg</strong> log for USB connect and disconnect events to avoid wasting
time on the NUT driver when the actual problem is USB.</p></div>
<div class="paragraph"><p>For example, if someone yanks the cable out of the USB port, or if a
new USB device is plugged into a USB host/hub that is struggling to
power its ports (common on single-board computers like Raspberry Pi),
or if you have flaky cabling or EMI noise, due to all these and similar
reasons the serial converter can get disconnected from USB, at least
briefly.</p></div>
<div class="paragraph"><p>This creates a permanent data stale situation, and the driver must be
restarted (plugging the USB back won&#8217;t fix it, since the driver is still
using the nonexistent serial device, if the system kernel initializes
a new device driver instance internally).</p></div>
<div class="paragraph"><p>These USB problems usually have nothing to do with NUT. If it&#8217;s the case,
you should solve the underlying USB problem&#8201;&#8212;&#8201;check the cable, check the
converter, try a powered USB hub, try a full-speed USB isolator, etc.</p></div>
</div>
<div class="sect2">
<h3 id="_serial_port_becomes_unresponsive">Serial port becomes unresponsive</h3>
<div class="paragraph"><p>Some malformed commands are known to lock up the serial port (including
USB, which is a USB-to-serial device). Upon receiving them, UPS2000 stops
all serial communications. The result is a completely unresponsive UPS,
regardless of what you do&#8201;&#8212;&#8201;restarting NUT, rebooting the computer&#8201;&#8212;&#8201;can
not restore connectivity, as if someone has unplugged the RS-232 cable.</p></div>
<div class="paragraph"><p>To recover, simply power cycle the UPS: Turn off the UPS output via the
front panel, then unplug the UPS from line power. Wait for the LCD front
screen to go black. Finally reconnect line power and restart your UPS.</p></div>
<div class="paragraph"><p>That being said, a serial port lockup is unlikely to happen. To our best
knowledge, this driver never sends malformed commands to the UPS (it was
only a problem during early development). Furthermore, due to a CRC checksum,
they&#8217;re unlikely to be accidentally generated.</p></div>
<div class="paragraph"><p>Still, we recommend to power cycle your UPS after making a cabling change,
especially after changing from RS-485/USB to RS-232, just to ensure the
UPS selects the correct communication interface. Also, if you have
discovered a reproducible serial port lockup problem, it can be a
previously unknown bug, so please make sure to file a bug report.</p></div>
</div>
<div class="sect2">
<h3 id="_usb_chip_maxlinear_exar_rx21v1410_is_unsupported">USB chip (MaxLinear/Exar RX21V1410) is unsupported</h3>
<div class="paragraph"><p>As previously stated, only RS-232 is supported on all systems. On
most UPS units, the USB chip RX21V1410 is used, and it requires a
device-specific driver <strong>xr_serial</strong>, which is only available on Linux
5.12 and newer kernels.</p></div>
<div class="paragraph"><p>On an unsupported system, the USB device can still be recognized as a
USB ACM device, but in reality, communication is impossible. It can
only be fixed by implementing a driver for your system, nothing can
be done within NUT. Please use the RS-232 port instead.</p></div>
<div class="paragraph"><p>Alternatively, if your unit has a WCH CH341 chip (likely only found in
units made after 2022), it should have better compatibility.</p></div>
<div class="paragraph"><p>See the previous section <strong>Cabling</strong> for more information.</p></div>
<div class="paragraph"><p>Finally, in the unlike scenario that you are using NUT on Microsoft
Windows, you should be able to install the USB device driver following
the steps in the Huawei UPS2000 (1 kVA-3 kVA) Modbus Protocol Development
Guide.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_author">AUTHOR</h2>
<div class="sectionbody">
<div class="paragraph"><p>Yifeng Li &lt;<a href="mailto:tomli@tomli.me">tomli@tomli.me</a>&gt;</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_see_also">SEE ALSO</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_the_core_driver">The core driver:</h3>
<div class="paragraph"><p><a href="nutupsdrv.html">nutupsdrv(8)</a></p></div>
</div>
<div class="sect2">
<h3 id="_internet_resources">Internet resources:</h3>
<div class="ulist"><ul>
<li>
<p>
The NUT (Network UPS Tools) home page: <a href="https://www.networkupstools.org/">https://www.networkupstools.org/</a>
</p>
</li>
<li>
<p>
Huawei UPS2000-A (1 kVA-3 kVA) User Manual:
  <a href="https://support.huawei.com/enterprise/en/doc/EDOC1000084260">https://support.huawei.com/enterprise/en/doc/EDOC1000084260</a>
</p>
</li>
<li>
<p>
Huawei UPS2000 (1 kVA-3 kVA) Modbus Protocol Development Guide:
  <a href="https://support.huawei.com/enterprise/en/doc/EDOC1000110696">https://support.huawei.com/enterprise/en/doc/EDOC1000110696</a>
</p>
</li>
<li>
<p>
libmodbus home page: <a href="http://libmodbus.org">http://libmodbus.org</a>
</p>
</li>
</ul></div>
</div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated 2025-06-25 15:01:19 UTC -- Network UPS Tools 2.8.3.589
</div>
</div>
</body>
</html>
