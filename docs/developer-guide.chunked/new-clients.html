<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>9. Creating new client</title><link rel="stylesheet" type="text/css" href="docbook-xsl.css" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="home" href="index.html" title="Network UPS Tools Developer Guide" /><link rel="up" href="index.html" title="Network UPS Tools Developer Guide" /><link rel="prev" href="devscan.html" title="8. NUT device discovery" /><link rel="next" href="net-protocol.html" title="10. Network protocol information" /><meta xmlns="" name="format-detection" content="telephone=no" /><script xmlns="" type="text/javascript">

// @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&dn=expat.txt Expat
//
// AnchorJS - v5.0.0 - 2023-01-18
// https://www.bryanbraun.com/anchorjs/
// Copyright (c) 2023 Bryan Braun; Licensed MIT
//
// @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&dn=expat.txt Expat
!function(A,e){"use strict";"function"==typeof define&&define.amd?define([],e):"object"==typeof module&&module.exports?module.exports=e():(A.AnchorJS=e(),A.anchors=new A.AnchorJS)}(globalThis,function(){"use strict";return function(A){function u(A){A.icon=Object.prototype.hasOwnProperty.call(A,"icon")?A.icon:"",A.visible=Object.prototype.hasOwnProperty.call(A,"visible")?A.visible:"hover",A.placement=Object.prototype.hasOwnProperty.call(A,"placement")?A.placement:"right",A.ariaLabel=Object.prototype.hasOwnProperty.call(A,"ariaLabel")?A.ariaLabel:"Anchor",A.class=Object.prototype.hasOwnProperty.call(A,"class")?A.class:"",A.base=Object.prototype.hasOwnProperty.call(A,"base")?A.base:"",A.truncate=Object.prototype.hasOwnProperty.call(A,"truncate")?Math.floor(A.truncate):64,A.titleText=Object.prototype.hasOwnProperty.call(A,"titleText")?A.titleText:""}function d(A){var e;if("string"==typeof A||A instanceof String)e=[].slice.call(document.querySelectorAll(A));else{if(!(Array.isArray(A)||A instanceof NodeList))throw new TypeError("The selector provided to AnchorJS was invalid.");e=[].slice.call(A)}return e}this.options=A||{},this.elements=[],u(this.options),this.add=function(A){var e,t,o,i,n,s,a,r,l,c,h,p=[];if(u(this.options),0!==(e=d(A=A||"h2, h3, h4, h5, h6")).length){for(null===document.head.querySelector("style.anchorjs")&&((A=document.createElement("style")).className="anchorjs",A.appendChild(document.createTextNode("")),void 0===(h=document.head.querySelector('[rel="stylesheet"],style'))?document.head.appendChild(A):document.head.insertBefore(A,h),A.sheet.insertRule(".anchorjs-link{opacity:0;text-decoration:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}",A.sheet.cssRules.length),A.sheet.insertRule(":hover>.anchorjs-link,.anchorjs-link:focus{opacity:1}",A.sheet.cssRules.length),A.sheet.insertRule("[data-anchorjs-icon]::after{content:attr(data-anchorjs-icon)}",A.sheet.cssRules.length),A.sheet.insertRule('@font-face{font-family:anchorjs-icons;src:url(data:n/a;base64,AAEAAAALAIAAAwAwT1MvMg8yG2cAAAE4AAAAYGNtYXDp3gC3AAABpAAAAExnYXNwAAAAEAAAA9wAAAAIZ2x5ZlQCcfwAAAH4AAABCGhlYWQHFvHyAAAAvAAAADZoaGVhBnACFwAAAPQAAAAkaG10eASAADEAAAGYAAAADGxvY2EACACEAAAB8AAAAAhtYXhwAAYAVwAAARgAAAAgbmFtZQGOH9cAAAMAAAAAunBvc3QAAwAAAAADvAAAACAAAQAAAAEAAHzE2p9fDzz1AAkEAAAAAADRecUWAAAAANQA6R8AAAAAAoACwAAAAAgAAgAAAAAAAAABAAADwP/AAAACgAAA/9MCrQABAAAAAAAAAAAAAAAAAAAAAwABAAAAAwBVAAIAAAAAAAIAAAAAAAAAAAAAAAAAAAAAAAMCQAGQAAUAAAKZAswAAACPApkCzAAAAesAMwEJAAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAAAAAAAAAQAAg//0DwP/AAEADwABAAAAAAQAAAAAAAAAAAAAAIAAAAAAAAAIAAAACgAAxAAAAAwAAAAMAAAAcAAEAAwAAABwAAwABAAAAHAAEADAAAAAIAAgAAgAAACDpy//9//8AAAAg6cv//f///+EWNwADAAEAAAAAAAAAAAAAAAAACACEAAEAAAAAAAAAAAAAAAAxAAACAAQARAKAAsAAKwBUAAABIiYnJjQ3NzY2MzIWFxYUBwcGIicmNDc3NjQnJiYjIgYHBwYUFxYUBwYGIwciJicmNDc3NjIXFhQHBwYUFxYWMzI2Nzc2NCcmNDc2MhcWFAcHBgYjARQGDAUtLXoWOR8fORYtLTgKGwoKCjgaGg0gEhIgDXoaGgkJBQwHdR85Fi0tOAobCgoKOBoaDSASEiANehoaCQkKGwotLXoWOR8BMwUFLYEuehYXFxYugC44CQkKGwo4GkoaDQ0NDXoaShoKGwoFBe8XFi6ALjgJCQobCjgaShoNDQ0NehpKGgobCgoKLYEuehYXAAAADACWAAEAAAAAAAEACAAAAAEAAAAAAAIAAwAIAAEAAAAAAAMACAAAAAEAAAAAAAQACAAAAAEAAAAAAAUAAQALAAEAAAAAAAYACAAAAAMAAQQJAAEAEAAMAAMAAQQJAAIABgAcAAMAAQQJAAMAEAAMAAMAAQQJAAQAEAAMAAMAAQQJAAUAAgAiAAMAAQQJAAYAEAAMYW5jaG9yanM0MDBAAGEAbgBjAGgAbwByAGoAcwA0ADAAMABAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAH//wAP) format("truetype")}',A.sheet.cssRules.length)),h=document.querySelectorAll("[id]"),t=[].map.call(h,function(A){return A.id}),i=0;i<e.length;i++)if(this.hasAnchorJSLink(e[i]))p.push(i);else{if(e[i].hasAttribute("id"))o=e[i].getAttribute("id");else if(e[i].hasAttribute("data-anchor-id"))o=e[i].getAttribute("data-anchor-id");else{for(r=a=this.urlify(e[i].textContent),s=0;n=t.indexOf(r=void 0!==n?a+"-"+s:r),s+=1,-1!==n;);n=void 0,t.push(r),e[i].setAttribute("id",r),o=r}(l=document.createElement("a")).className="anchorjs-link "+this.options.class,l.setAttribute("aria-label",this.options.ariaLabel),l.setAttribute("data-anchorjs-icon",this.options.icon),this.options.titleText&&(l.title=this.options.titleText),c=document.querySelector("base")?window.location.pathname+window.location.search:"",c=this.options.base||c,l.href=c+"#"+o,"always"===this.options.visible&&(l.style.opacity="1"),""===this.options.icon&&(l.style.font="1em/1 anchorjs-icons","left"===this.options.placement)&&(l.style.lineHeight="inherit"),"left"===this.options.placement?(l.style.position="absolute",l.style.marginLeft="-1.25em",l.style.paddingRight=".25em",l.style.paddingLeft=".25em",e[i].insertBefore(l,e[i].firstChild)):(l.style.marginLeft=".1875em",l.style.paddingRight=".1875em",l.style.paddingLeft=".1875em",e[i].appendChild(l))}for(i=0;i<p.length;i++)e.splice(p[i]-i,1);this.elements=this.elements.concat(e)}return this},this.remove=function(A){for(var e,t,o=d(A),i=0;i<o.length;i++)(t=o[i].querySelector(".anchorjs-link"))&&(-1!==(e=this.elements.indexOf(o[i]))&&this.elements.splice(e,1),o[i].removeChild(t));return this},this.removeAll=function(){this.remove(this.elements)},this.urlify=function(A){var e=document.createElement("textarea");return e.innerHTML=A,A=e.value,this.options.truncate||u(this.options),A.trim().replace(/'/gi,"").replace(/[& +$,:;=?@"#{}|^~[`%!'<>\]./()*\\\n\t\b\v\u00A0]/g,"-").replace(/-{2,}/g,"-").substring(0,this.options.truncate).replace(/^-+|-+$/gm,"").toLowerCase()},this.hasAnchorJSLink=function(A){var e=A.firstChild&&-1<(" "+A.firstChild.className+" ").indexOf(" anchorjs-link "),A=A.lastChild&&-1<(" "+A.lastChild.className+" ").indexOf(" anchorjs-link ");return e||A||!1}}});
// @license-end

		</script><style xmlns="" type="text/css">
		a.anchorjs-link {
			color: inherit;
			text-decoration: inherit;
		}
		a.anchorjs-link:visited {
			color: inherit;
			text-decoration: inherit;
		}
	</style></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><td width="20%" align="left"><a accesskey="p" href="devscan.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="net-protocol.html">Next</a></td></tr></table><hr /></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="new-clients"></a>9. Creating new client</h2></div></div></div><p>NUT provides bindings for several common languages that are
presented below. All these are released under the same license as
NUT (the GNU General Public License).</p><p>If none of these suits you for technical or legal reasons, you can
implement one easily using the <a class="link" href="net-protocol.html" title="10. Network protocol information">Network protocol information</a>.</p><p>The latter approach has been used to create the Python <span class="emphasis"><em>PyNUTClient</em></span> module,
the Nagios <span class="emphasis"><em>check_ups</em></span> plugin (and probably others), which can serve as a
reference.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_c_c"></a>9.1. C / C++</h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_client_access_library_2"></a>Client access library</h4></div></div></div><p><code class="literal">libupsclient</code> and <code class="literal">libnutclient</code> libraries can be linked into other programs
to give access to upsd and UPS status information.
Both static and shared versions are provided.</p><p>These library files and associated header files are not installed by
default.  You must <code class="literal">./configure --with-dev</code> to enable building and
installing these files. The libraries can then be built and installed
with <code class="literal">make</code> and <code class="literal">make install</code> as usual. This must be done before
building other (non-NUT) programs which depend on them.</p><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="_low_level_library_libupsclient"></a>Low-level library: libupsclient</h5></div></div></div><p><code class="literal">libupsclient</code> provides a low-level interface to directly dialog with upsd.
It is a wrapper around the NUT network protocol.</p><p>For more information, refer to the <a class="ulink" href="../man/upsclient.html" target="_top">upsclient(3)</a>,
manual page and the various <a class="ulink" href="../man/index.html#devclient" target="_top">upscli_*(3)</a>
functions documentation referenced in the same file.</p><p>Clients like upsc are provided as examples of how to retrieve data using the
upsclient functions.
<a class="ulink" href="https://www.networkupstools.org/projects.html" target="_top">Other programs</a> not included
in this package may also use this library, such as wmnut.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="_high_level_library_libnutclient"></a>High level library: libnutclient</h5></div></div></div><p><code class="literal">libnutclient</code> provides a high-level interface representing devices, variables
and commands with an object-oriented API in C++ and C.</p><p>For more information, refer to the <a class="ulink" href="../man/libnutclient.html" target="_top">libnutclient(3)</a> manual page.</p><pre class="screen">  #include &lt;iostream&gt;
  #include &lt;unistd.h&gt;
  #include &lt;stdlib.h&gt;

  #include &lt;nutclient.h&gt;

  using namespace nut;
  using namespace std;

  /* argv[1] is the mandatory NUT device name (@localhost),
   *    used to list variables from
   * argv[2] is an optional command. When provided, it will be
   *    executed and possibly with status tracking enabled
   */
  int main(int argc, char **argv)
  {
    Client *client;
    try
    {
      // Connection
      client = new TcpClient("localhost", 3493);

      if (argc &gt;= 2)
      {
        // Reading data from device
        Device mydev = client-&gt;getDevice(argv[1]);
        cout &lt;&lt; "Description: " &lt;&lt; mydev.getDescription() &lt;&lt; endl;
        Variable var = mydev.getVariable("device.model");
        cout &lt;&lt; "Model: " &lt;&lt;  var.getValue()[0] &lt;&lt; endl;

        if (argc &gt;= 3)
        {
          // Authenticate to NUT server
          const char *user = getenv("NUT_USER");
          const char *password = getenv("NUT_PASSWD");
          client-&gt;authenticate(user ? user : "", password ? password : "");

          // Enable command tracking, if available
          if (client-&gt;hasFeature(Client::TRACKING))
          {
            cout &lt;&lt; "Server can do command tracking" &lt;&lt; std::endl;
            client-&gt;setFeature(Client::TRACKING, true);
          }
          else
          {
            std::cout &lt;&lt; "Server can't do command tracking" &lt;&lt; std::endl;
          }

          // Perform an asynchronous command
          TrackingID id = mydev.executeCommand(argv[2]);
          TrackingResult result;
          do
          {
            sleep(1);
            result = client-&gt;getTrackingResult(id);
          }
          while (result == PENDING);

          // Display result of command
          const char *output = "&lt;UNRECOGNIZED&gt;";
          switch (result)
          {
            case SUCCESS: output = "SUCCESS"; break;
            case FAILURE: output = "FAILURE"; break;
            case UNKNOWN: output = "UNKNOWN"; break;
          }
          cout &lt;&lt; "Command sent, result=" &lt;&lt; output &lt;&lt; endl;
        }
      }
    }
    catch (NutException &amp;ex)
    {
      cerr &lt;&lt; "Unexpected problem : " &lt;&lt; ex.str() &lt;&lt; endl;
    }
    delete client;
    return 0;
  }</pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_configuration_helpers_2"></a>Configuration helpers</h4></div></div></div><p>NUT provides helper scripts to ease the configuration step of your program, by
detecting the right compilation and link flags.</p><p>For more information, refer to a
<a class="link" href="lib-info.html" title="C. NUT libraries complementary information">Appendix B: NUT libraries complementary information</a>.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_python_3"></a>9.2. Python</h3></div></div></div><p>The PyNUT module, contributed by David Goncalves, can be used for connecting a
Python script to <code class="literal">upsd</code>. Note that this code (and the accompanying NUT-Monitor
application, later separated into NUT-Monitor-py2gtk2, NUT-Monitor-py3qt5 and
NUT-Monitor-py3qt6, suitable for two generations of the Python ecosystem) is
licensed under the GPL v3.</p><p>The <code class="literal">PyNUTClient</code> class abstracts the connection to the server. In order to
list the status variables for <code class="literal">ups1</code> on the local <code class="literal">upsd</code>, the following
commands could be used:</p><pre class="literallayout">$ cd scripts/python/module
$ python
...
&gt;&gt;&gt; import PyNUT
&gt;&gt;&gt; from pprint import pprint
&gt;&gt;&gt; client = PyNUT.PyNUTClient()
&gt;&gt;&gt; vars = client.GetUPSVars('ups1')
&gt;&gt;&gt; pprint(vars)
{'battery.charge': '90',
 'battery.charge.low': '30',
 'battery.runtime': '3690',
 'battery.voltage': '230.0',
...</pre><p>Further examples are given in the <code class="literal">test_nutclient.py</code> file. To see the entire
API, you can run <code class="literal">pydoc</code> from the <code class="literal">module</code> directory.</p><p>If you wish to make the module available to everyone on the system, you will
probably want to install it in the <code class="literal">site-packages</code> directory for your Python
interpreter. (This is usually one of the last items in <code class="literal">sys.path</code>.)</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_perl_3"></a>9.3. Perl</h3></div></div></div><p>The old Perl bindings from CPAN have recently been updated and merged into the
NUT source code. These operate in a similar fashion to the Python bindings,
with the addition of access to single variables, and additional interpretation
of the results. The Perl class instance encapsulates a single UPS, where the
Python class instance represents a connection to the server (which may service
multiple UPS units).</p><pre class="screen"> use UPS::Nut;

 $ups = new UPS::Nut( NAME =&gt; "myups",
                      HOST =&gt; "somemachine.somewhere.com",
                      PORT =&gt; "3493",
                      USERNAME =&gt; "upsuser",
                      PASSWORD =&gt; "upspasswd",
                      TIMEOUT =&gt; 30,
                      DEBUG =&gt; 1,
                      DEBUGOUT =&gt; "/some/file/somewhere",
                    );
 if ($ups-&gt;Status() =~ /OB/) {
    print "Oh, no!  Power failure!\n";
 }

 tie %other_ups, 'UPS::Nut',
     NAME =&gt; "myups",
     HOST =&gt; "somemachine.somewhere.com",
     ... # same options as new();
 ;

 print $other_ups{MFR}, " ", $other_ups{MODEL}, "\n";</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_java_2"></a>9.4. Java</h3></div></div></div><p>The NUT Java support has been externalized.
It is available at <a class="ulink" href="https://github.com/networkupstools/jnut" target="_top">https://github.com/networkupstools/jnut</a></p></div></div><div xmlns="" class="navfooter nut_footer"><hr />
		Last updated 2025-12-18 11:49:17 -- Network UPS Tools 2.8.4.888</div><script xmlns="" type="text/javascript">anchors.add();</script><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="devscan.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="net-protocol.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top"> </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> </td></tr></table></div></body></html>